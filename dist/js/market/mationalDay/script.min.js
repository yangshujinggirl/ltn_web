$(function(){function e(){return w.times+=1,w.roll(),w.times>w.cycle+10&&w.prize==w.index?(clearTimeout(w.timer),w.prize=-1,w.times=0,g=!1,setTimeout(function(){x.$rollContent.attr("data-type")?v(x.$rollContent):n(),i.call()},500)):(w.times<w.cycle?w.speed-=10:w.times==w.cycle?w.prize=parseInt(x.prizeIndex):w.times>w.cycle+10&&(0==w.prize&&7==w.index||w.prize==w.index+1)?w.speed+=110:w.speed+=20,w.speed<40&&(w.speed=40),w.timer=setTimeout(e,w.speed)),!1}function t(e,t){w.index=0,w.init(e);var a=$("#"+e).find(".choujiang_btn");a.unbind("click"),a.bind("click",function(){if(w.click)return!1;var e=$(this).attr("data-code");if($(this).parents("#lottery2").length>0||$(this).parents("#lottery3").length>0||$(this).parents("#lottery4").length>0)"2"==e?user().loginOperate():e==-1?window.location.href="/html/product/#!/short/0/0/1":1==e&&u(x.BCDRollType,function(e){t.call()});else if("2"==e)user().loginOperate();else{if("1"==e)return!1;"3"==e?window.location.href="/html/product/#!/short/0/0/1":"4"!=e&&"6"!=e||d(function(e){t.call()})}})}function a(){var a=$(".truning_list").find("li");a.bind("click",function(){var a=$(this);if(!a.hasClass("active")){var n=a.siblings("li.active");$(".turning_cont1").find("."+n.attr("data-tab")).hide();var i=$(".turning_cont1").find("."+a.attr("data-tab"));n.removeClass("active"),a.addClass("active"),x.$currentTab=a,x.$rollContent=i,i.hasClass("huolizhi")?s(i,function(){var a=i.attr("data-lottery");t(a,function(){e()}),i.show()}):v(i,function(){var a=i.attr("data-lottery");t(a,function(){e()}),i.show()})}}),a.eq(0).trigger("click")}function n(){s(x.$rollContent)}function i(){$(".mationalDay_cover").show();var e,t;if("huolizhi"===x.$currentTab.attr("data-tab"))$(".huolizhi-tips").show().find(".prize_info").text(x.type1.awardName[x.prizeIndex]);else{var a=parseInt(x.prizeIndex)+1;"gold"===x.$currentTab.attr("data-tab")?(e=x.type2.awardName[x.prizeIndex],t="tp1_prize"+a):"buckingham"===x.$currentTab.attr("data-tab")?(e=x.type3.awardName[x.prizeIndex],t="tp2_prize"+a):"diamonds"===x.$currentTab.attr("data-tab")&&(e=x.type4.awardName[x.prizeIndex],t="tp3_prize"+a),$(".congratulations").show().find(".drawn_title2 span").text(e),$(".congratulations").show().find(".prize_left").removeClass().addClass("prize_left").addClass(t)}}function r(e){$(".mationalDay_cover").hide(),e.hide()}function o(e,t){x.getData("/market/activity/info",{serviceName:"NATIONAL_THREE_INTEGRAL"},function(a){var n=a.data.result;x.type1.activeValue=n,p(n),e<=0?x.type1.awardStatus="3":n===-1?x.type1.awardStatus="4":x.type1.awardStatus="6",n===-1&&(x.type1.activeValue=0),"1"==x.rollIsOver&&(x.type1.awardStatus="1"),t.apply()})}function l(e){x.getData(y,{serviceName:"NATIONAL_THREE_CHANCE"},function(t){var a=t.data.result;e.call(this,a)})}function s(e,t){user().isLogin()?l(function(a){x.type1.chance=a,o(a,function(){e.find(".choujiang_btn").hide().filter('[data-code="'+x.type1.awardStatus+'"]').show(),c(e),t&&t.call()})}):(x.type1.awardStatus="2","1"==x.rollIsOver&&(x.type1.awardStatus="1"),e.find(".choujiang_btn").hide().filter('[data-code="'+x.type1.awardStatus+'"]').show(),c(e),t.call())}function c(e){var t=x.type1.chance===-1||"over"==x.type1.chance?0:x.type1.chance;e.find(".chance").text(t),e.find(".activeValue").text(x.type1.activeValue)}function d(e){x.getData(y,{serviceName:"NATIONAL_THREE_DRAW_INTEGRAL"},function(t){if(x.isSuccess(t)){var a=null;a=t.data.result,x.prizeIndex=x.type1.awardCode[parseInt(a)],e.call(this,a)}else $(".mationalDay_cover").show(),$(".exception-tips").show()})}function u(e,t){x.getData(y,{parameter:e,serviceName:"THREE_DRAW"},function(a){if(x.isSuccess(a)){var n=null;n=a.data.result.prizesId,"B"===e?x.prizeIndex=x.type2.awardCode[parseInt(n)]:"C"===e?x.prizeIndex=x.type3.awardCode[parseInt(n)]:"D"===e&&(x.prizeIndex=x.type4.awardCode[parseInt(n)]),t.call(this,n)}else $(".mationalDay_cover").show(),$(".exception-tips").show()})}function p(e){x.getData(y,{serviceName:"EXCHANGE_REWARDS"},function(t){for(var a=t.data.result,n=0,i=a.length;n<i;n++){var r=a[n],o=r.rewardId.toString();x.energys[o];x.energys[o].number=r.number}for(var l in x.energys){var s=x.energys[l];s.score<=e?s.isUsable=!0:s.isUsable=!1}var c=$(".turning_caption").find(".caption");$.each(c,function(e){var t=c[e],a=$(t).attr("data-prizeCode"),n=x.energys[a];n.isUsable?$(t).find("button").removeClass("disabled"):$(t).find("button").addClass("disabled"),$(t).find(".cashing span").text(n.number||"0")})})}function f(e,t,a){x.getData(y,{exchangeType:e,serviceName:"NATIONAL_THREE_EXCHANGE_INTEGRAL"},function(e){x.isSuccess(e)?($(".mationalDay_cover").show(),1!=e.data.result?$(".bird_reminded").show():(s(x.$rollContent),p(x.type1.activeValue),$(".congratulations").show(),$(".congratulations").find(".prize_left").removeClass().addClass("prize_left"),$(".congratulations").find(".prize_left").addClass("tp4_prize"+t),$(".congratulations").find(".drawn_title2 span").text(a),$(".congratulations").find(".drawn_title2 i").text("成功兑换"))):($(".mationalDay_cover").show(),$(".exception-tips").show())})}function h(e,t){x.getData(y,{parameter:e,serviceName:"THREE_ME"},function(a){if(x.isSuccess(a)){var n=a.data.result,i=e+"_PrizeRecord";x.initTemplate(n.resultMe,i,"templatePrizeRecord"),t.call(this,n)}else{var i=e+"_PrizeRecord";x.initTemplate(null,i,"templatePrizeRecord")}})}function m(e,t){x.getData(y,{parameter:e,serviceName:"THREE_RECORD"},function(a){var n=a.data.result,i=e+"_PlatformPrizeRecord";x.initTemplate(n.resultPlat,i,"templatePlatformPrizeRecord"),t.call(),$("#"+i).find(".platform-record-data").kxbdMarquee({direction:"up",isEqual:!1})})}function v(e,t){var a=e.attr("data-type");if(x.BCDRollType=a,m(a,function(){t&&t.call()}),user().isLogin())h(a,function(t){x.roll.chance=0,x.roll.maxOrderAmount=t.maxOrderAmount,0===x.roll.chance?x.roll.currentCode=4:x.roll.chance===-1?x.roll.currentCode=-1:x.roll.currentCode=1,"1"==x.rollIsOver&&(x.roll.currentCode=3),e.find("td[data-code]").hide().filter('td[data-code="'+x.roll.currentCode+'"]').show(),e.find(".surplus span").text(x.roll.chance===-1?0:x.roll.chance),e.find(".present span").text(x.roll.maxOrderAmount+"元")});else{x.roll.currentCode=2,x.roll.chance=0,x.roll.maxOrderAmount=0,"1"==x.rollIsOver&&(x.roll.currentCode=3),e.find("td[data-code]").hide().filter('td[data-code="'+x.roll.currentCode+'"]').show(),e.find(".surplus span").text(x.roll.chance===-1?0:x.roll.chance),e.find(".present span").text(x.roll.maxOrderAmount+"元");var n=a+"_PrizeRecord";x.initTemplate({noLogin:!0},n,"templatePrizeRecord"),$(".logoIcon").find(".denglu").bind("click",function(){user().loginOperate()})}}var y="/market/activity/info",w={index:-1,count:0,timer:0,speed:20,times:0,cycle:50,prize:-1,init:function(e){$("#"+e).find(".lottery-unit").length>0&&($lottery=$("#"+e),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var e=this.index,t=this.count,a=this.obj;return $(a).find(".lottery-unit-"+e).removeClass("active"),e+=1,e>t-1&&(e=0),$(a).find(".lottery-unit-"+e).addClass("active"),this.index=e,!1},stop:function(e){return this.prize=e,!1}},g=!1,x=new Page;x.energys={30:{isUsable:!1,number:0,score:10,type:"A",name:"20元电话卡",index:1},31:{isUsable:!1,number:0,score:25,type:"B",name:"50元京东卡一张",index:2},32:{isUsable:!1,number:0,score:50,type:"C",name:"小米蓝牙音箱一个",index:3},33:{isUsable:!1,number:0,score:100,type:"D",name:"膳魔师保温杯一个",index:4},34:{isUsable:!1,number:0,score:500,type:"E",name:"双立人刀具七件套一份",index:5}},x.prizeIndex=-1,x.type1={awardCode:{21:"0",22:"1",23:"2",24:"3",25:"4"},awardName:{0:"5点活力值",1:"10点活力值",2:"15点活力值",3:"20点活力值",4:"25点活力值"},chance:0,awardStatus:"2",isShowBtn:!1,awardIndex:"",isClick:!1,activeValue:0},x.type2={awardCode:{11:"0",12:"1",14:"2",17:"3",15:"4"},awardName:{0:"50元京东卡一张",1:"小米蓝牙音箱一个",2:"九阳豆浆机一台",3:"iPhone7（128G）一部",4:"双立人刀具七件套一份"},chance:0,awardStatus:"2",isShowBtn:!1,awardIndex:"",isClick:!1},x.type3={awardCode:{13:"0",14:"1",15:"2",17:"3",16:"4"},awardName:{0:"膳魔师保温杯一个",1:"九阳豆浆机一台",2:"双立人刀具七件套一份",3:"iPhone7（128G）一部",4:"乐视50吋电视一台"},chance:0,awardStatus:"2",isShowBtn:!1,awardIndex:"",isClick:!1},x.type4={awardCode:{15:"0",16:"1",17:"2"},awardName:{0:"双立人刀具七件套一份",1:"乐视50吋电视一台",2:"iPhone7（128G）一部"},chance:0,awardStatus:"2",isShowBtn:!1,awardIndex:"",isClick:!1},x.getData(y,{serviceName:"AMOUNT_TOP50"},function(e){if(x.isSuccess(e)){var t=e.data.result.data;x.initTemplate(t,"Top50DataWrap","templateTop50"),$(".top-other").kxbdMarquee({direction:"up",isEqual:!1,scrollAmount:148,scrollDelay:2e3})}}),x.getData(y,{serviceName:"NATIONAL_TWO"},function(e){if(x.isSuccess(e)){var t=e.data.result;x.initTemplate(t,"InviteDataWrap","templateInvite"),$(".win_info").kxbdMarquee({direction:"up",isEqual:!0,scrollAmount:1,scrollDelay:40})}}),x.getData(y,{serviceName:"ISOVER"},function(e){x.rollIsOver=e.data.result,a()}),$(".drawn_prize").find(".close,.drawn_but").bind("click",function(){var e=$(this).parent(".drawn_prize");r(e)}),$(".turning_caption").find(".caption button").bind("click",function(){if($(this).hasClass("disabled"))return!1;var e=x.energys[$(this).parents(".caption").attr("data-prizeCode")];x.exchangeType=e.type,x.imgIndex=e.index,x.nameText=e.name,$(".mationalDay_cover").show(),$(".cashing_prize").show()}),$(".cashing_prize").find(".away").bind("click",function(){var e=$(this).parent(".drawn_prize");r(e)}),$(".cashing_prize").find(".sure").bind("click",function(){var e=$(this).parent(".drawn_prize");r(e),f(x.exchangeType,x.imgIndex,x.nameText)}),x.roll={btnCodeMap:{1:"立即抽奖",2:"登录",3:"活动截止",4:"无机会","-1":"投资激活"},currentCode:1,chance:0,maxOrderAmt:0}});