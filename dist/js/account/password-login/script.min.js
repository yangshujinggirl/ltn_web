$(function(){var e=new Page;e.setTitle("修改登录密码");var t=session().get("login");$("#txtTel").val(t),$("#txtTel").focus();var a={guid:"",isRealname:"",getImageCode:function(){var e={clientType:constant().clientType,machineNo:guid};$.post(constant().url+"/user/register/pictureCode",e,function(e,t){if("success"==t&&"0"==e.resultCode){var i=constant().url+e.data.pictureCode;template().renduTemplate("templateImageCode","imageCon",i),$("#imageCode").on("click",function(){a.getImageCode()}),$("input,select,textarea").on("blur",function(){_this=$(this);var e=_this.parent().parent(),t=e.find(".validation"),i="validate-success",s="validate-failed";validate().vd(_this,e,t,i,s,!1),a.addEvent(_this,e,t)}),$("input,select,textarea").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var t=e.find(".validation");t.html(""),$("#loginTip").hide()})}})},addEvent:function(e,t,i){return"txtTel"==e.attr("id")?(a.initSendBtn(),void(!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0&&a.getPhoneIsTrue(e))):"txtCode"==e.attr("id")?(a.initSendBtn(),void(!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0&&a.getCodeIsTrue(e))):"txtPsd2"==e.attr("id")&&!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void a.getPsdIsEqual(e.val()):void 0},getPhoneCode:function(){var e=$("#txtTel").val(),t=$("#txtCode").val(),i={clientType:constant().clientType,machineNo:guid,mobileNo:e,pictureCode:t,sendType:"2"};$.post(constant().url+"/mobile/pcmobilecode/getMobileCode",i,function(e,t){if("success"==t)if("0"==e.resultCode){a.isRealname?$("#wrapIdentity").show():$("#wrapIdentity").hide();var i=$("#sendPhoneCode");i.addClass("disabled").attr("disabled","disabled"),a.timing(i,50)}else a.initPhoneCode(),alert(e.resultMessage)})},initPhoneCode:function(){var e=$("#sendPhoneCode");e.html("重新发送").addClass("disabled").attr("disabled","disabled"),a.getImageCode(),$("#wrapImg").removeClass("validate-success")},timing:function(e,t){var a=setInterval(function(){--t,t<0?(clearInterval(a),$("#sendPhoneCode").removeClass("disabled"),e.html("重新发送")):e.html(t+"s")},1e3)},getPhoneIsTrue:function(e){var t=e.val(),i=e.parent().parent(),s=i.find(".validation"),n={clientType:constant().clientType,mobileNo:t};$.post(constant().url+"/pc/login/validateMobileExist",n,function(e,t){"success"==t&&"0"==e.resultCode&&("1"==e.data.isMobileExist?(i.addClass("validate-success").removeClass("validate-failed"),"1"==e.data.isMobileNameAuth?a.isRealname=!0:a.isRealname=!1):(i.addClass("validate-failed").removeClass("validate-success"),s.html("账号不存在!")),a.initSendBtn())})},getCodeIsTrue:function(e){var t=e.val(),i=e.parent().parent(),s=i.find(".validation"),n={clientType:constant().clientType,machineNo:guid,pictureCode:t};$.post(constant().url+"/pc/login/validatePicCode",n,function(e,t){"success"==t&&("0"==e.resultCode&&("1"==e.data.isPicCodeRight?i.addClass("validate-success").removeClass("validate-failed"):(i.addClass("validate-failed").removeClass("validate-success"),s.html("验证码错误!"),a.getImageCode())),a.initSendBtn())})},getPsdIsEqual:function(e){var t=_this.parent().parent(),a=t.find(".validation"),i=$("#txtPsd").val();e==i?t.addClass("validate-success").removeClass("validate-failed"):(t.addClass("validate-failed").removeClass("validate-success"),a.html("两次输入密码不一致!"))},initForget:function(){a.getImageCode()},Passwordlogin:function(e,t,i,s){var n={clientType:constant().clientType,idCard:i,mobileCode:t,mobileNo:e,newPwd:s};$.post(constant().url+"/user/login/forgetPwd",n,function(e,t){if("success"==t){var i=$("#wranTip");if("0"==e.resultCode)location.href="/html/user/login";else{$("#loginTip").show();var s;s=user().testResultCode(e.resultCode),i.html(s),a.initForget()}}})},getPhoneAndCodeIsTrue:function(){var e=$("#wrapTel"),t=$("#wrapImg");return!(!e.hasClass("validate-success")||!t.hasClass("validate-success"))},initSendBtn:function(){a.getPhoneAndCodeIsTrue()?$("#sendPhoneCode").removeClass("disabled").removeAttr("disabled"):$("#sendPhoneCode").addClass("disabled").attr("disabled","disabled")},dealPhoneCode:function(){var e=$("#sendPhoneCode");e.html("发送中..."),e.attr("disabled","disabled"),a.getPhoneCode()},left:function(){for(var e=location.pathname,t=$("#leftnav .item"),a=0,i=t.length;a<i;a++)t[a].href.indexOf(e)!=-1&&(t[a].className="selected item")},init:function(){guid=strUtil().getGuid(),a.getImageCode()}};a.init(),$("#password-login").on("click",function(){if(user().testSubmit(a.addEvent),0!=$("#form").find(".validate-failed").length)return!1;var e=$("#txtTel").val(),t=$("#txtPsd").val(),i=$("#txtPhoneCode").val(),s=$("#txtIdentity").val();a.Passwordlogin(e,i,s,t)}),$("#sendPhoneCode").on("click",a.dealPhoneCode)});