$(function(){function e(){$(this).parents(".open-close").hide(),$("#txtRechargeMoney").val("").focus()}var a=new Page;a.recharge=document.getElementById("recharge"),a.withDraw=document.getElementById("withDraw"),a.showCon=document.getElementById("showCon"),a.bankList=[],a.bankInfo={},a.bankName,a.isPsd,a.noPassword=!1,a.gateId,a.bindBankInfo={},a.accountInfo={},a.isFee,a.deductionCoin,a.getAccountInfo=function(){function e(e){a.isSuccess(e)&&(a.accountInfo=e.data,0==a.accountInfo.freeCount?a.accountInfo.birdCoin<5?(a.isFee=!0,a.deductionCoin=0):(a.isFee=!1,a.deductionCoin=5):(a.isFee=!1,a.deductionCoin=0),a.initTemplate(a.accountInfo,"depostInfo","templateDepostInfo"))}function t(){$("#userMoney").html("￥"+a.accountInfo.amount+"元")}return a.getData("/account/center/accountInfo",{},[e,t])},a.getBankList=function(){function e(e){if(a.isSuccess(e))e=e.data.bankList,a.initTemplate(e,"bankList","templateBankList"),a.pushBankList(e);else{user().testResultCode(e.resultCode)}$(".list .choose-bank:lt(7) .icon1").css("display","block")}return a.getData("/company/bankList",{},[e,a.bindBankList])},a.pushQuicklyBankList=function(e){if(e.length>0)for(var t=0;t<e.length;t++)a.bankInfo[e[t].bankName]=e[t]},a.pushBankList=function(e){var t={};if(t.limitationList={},e.length>0){for(var n=0;n<e.length;n++)t={},t.limitationList=e[n].limitationList,t.bankCode=e[n].bankCode,t.bankDes=e[n].bankDes,t.bankName=e[n].bankName,t.id=e[n].id,a.bankList.push(t);console.log(a.bankList)}},a.changeBankRemark=function(e){a.bankList.length>0&&e<=a.bankList.length&&($("#bankTable").show(),$("#bankTip").show(),a.initTemplate(a.bankList[e].limitationList,"bankRemark","templateBankRemark"),a.initTemplate(a.bankList[e].bankDes,"bankTip","templateBankTip"))},a.initState=function(){var e=urlUtil().get("control");if("recharge"==e||""==e){a.recharge.className="item selected",a.withDraw.className="item";var t="charg-depost current1";a.showCon.className=t}else{a.recharge.className="item",a.withDraw.className="item selected";var t="charg-depost current2";a.showCon.className=t}user().isBindCard()?($("#quickBank").removeClass("hide"),$("#bindCard").show(),user().isAgreementCZ()&&($("#onState").hide(),a.isPsd=!0),a.getBIndCardInfo()):$("#noBindCard").show()},a.changeNav=function(e,t){if("item selected"!=e.className){e.className="item selected";var n;"type1"==t?(a.withDraw.className="item",n="charg-depost current1"):(a.recharge.className="item",n="charg-depost current2"),a.showCon.className=n}},a.changeRecharge=function(e){for(var a=document.querySelectorAll(".recharge"),t=e.getAttribute("data-type"),n=document.getElementById("chargeWay"),i="recharge",o=0;o<a.length;o++)a[o]==e?(i=e.className,e.className="recharge selected","interBank"==t?n.className="chargeway ebank":n.className="chargeway quickly"):"recharge hide"==a[o].className?a[o].className="recharge hide":a[o].className="recharge"},a.changeRecharge2=function(e){return function(){a.changeRecharge(e)}},a.bindRecharge=function(){for(var e=document.querySelectorAll(".recharge"),t=0;t<e.length;t++)e[t].addEventListener("click",a.changeRecharge2(e[t]),!1)},a.changeBank=function(e){var t=document.querySelectorAll(".choose-bank"),n=e.getAttribute("data-index");a.gateId=e.getAttribute("data-code");for(var i=0;i<t.length;i++)t[i]==e?(e.className="choose-bank selected",a.changeBankRemark(n)):t[i].className="choose-bank"},a.changeBank2=function(e){return function(){a.changeBank(e)}},a.bindBankList=function(){for(var e=document.querySelectorAll(".choose-bank"),t=0;t<e.length;t++)e[t].addEventListener("click",a.changeBank2(e[t]),!1)},a.getBIndCardInfo=function(){function e(e){if(a.isSuccess(e))a.bankName=e.data.belongBank,e=e.data,a.bindBankInfo=e,a.initTemplate(e,"cardModel","templateCardModel"),a.initTemplate(e,"cardModel2","templateCardModel");else{var t=user().testResultCode(e.resultCode);alert(t)}}function t(){var e=a.bankInfo[a.bankName];void 0!=e&&($("#onceTimeMoney").html(e.chargeTimeLimit),$("#onceDayMoney").html(e.chargeDateLimit))}return a.getData("/account/center/bankInfo",{},[e,t])},a.largeRecharge=function(){var e=$("#txtRechargeMoney").val(),t={gateId:a.gateId,orderAmount:e};user().goNewPage(t,"1"),$("#largeRechargePopup").show()},a.goSurePage=function(){var e="/html/account/confirmation",t=$("#txtRechargeMoney").val();a.bindBankInfo.money=t,a.post(e,a.bindBankInfo),window.location.href=e},a.tixianmoney=function(){var e="/html/account/bank2_confirm/",t=$("#txtWithdraw").val(),n=a.deductionCoin;a.bindBankInfo.birdCoin=n,a.bindBankInfo.money=t,a.post(e,a.bindBankInfo)},a.addEvent=function(e,t,n){if("txtWithdraw"==e.attr("id")){if(strUtil().trim(e.val()).length>0&&!isNaN(parseFloat(e.val()))){var i=parseFloat(e.val()),o=parseFloat(a.accountInfo.amount);a.isFee?i<=2&&o<=2?(t.addClass("validate-failed").removeClass("validate-success"),n.html("你的金额小于等于2元,请等待下个月提现")):i+2>o?(t.addClass("validate-failed").removeClass("validate-success"),n.html("提现金额超出可用余额")):i+2<=o&&($("#actualMoney").text(i),t.addClass("validate-success").removeClass("validate-failed"),n.html("")):i>o?(t.addClass("validate-failed").removeClass("validate-success"),n.html("提现金额超出可用余额")):($("#actualMoney").text(i),t.addClass("validate-success").removeClass("validate-failed"),n.html(""))}else $("#actualMoney").text("");return!1}},a.testWithDraw=function(){$("#actualMoney").html().replace("元",""),a.deductionCoin},$(".card").on("click",function(){window.location.href="/html/account/card1/"}),a.leftnav=function(){for(var e=location.pathname,a=$("#leftnav .item"),t=0,n=a.length;t<n;t++)a[t].href.indexOf(e)!=-1&&(a[t].className="selected item")},a.init=function(){a.setTitle("我的银行卡"),user().loginOperate(),user().isNameAuth()||(window.location.href="/html/account/realname/"),a.leftnav(),user().updateUserInfo(),a.getAccountInfo(),a.when(a.getBankList,[a.initState]),a.bindRecharge()},a.init(),a.recharge.addEventListener("click",function(){a.changeNav(this,"type1")},!1),a.withDraw.addEventListener("click",function(){a.changeNav(this,"type2")},!1),$("input[data-type=money]").on("blur",function(){_this=$(this);var e=_this.parent().parent(),t=e.find(".validation"),n="validate-success",i="validate-failed";validate().vd(_this,e,t,n,i,!1),a.addEvent(_this,e,t)}),$("#txtWithdraw").on("input",function(){_this=$(this);var e=_this.parent().parent(),t=e.find(".validation");a.addEvent(_this,e,t)}),$("input[data-type=money]").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var a=e.find(".validation");a.html(""),$("#loginTip").hide()}),$("#submit").on("click",function(){return user().testSubmit(),0==$("#form").find(".validate-failed").length&&void(0==$("#bankList").find(".selected").length?alert("请选择银行"):a.largeRecharge())}),$("#submit3").on("click",function(){return user().testSubmit(a.addEvent),0==$("#form2").find(".validate-failed").length&&(a.testWithDraw(),void a.tixianmoney())}),$(".goCenter").on("click",function(){window.location.href="/html/account/detail2/?control=detailCharge"}),$(".goHelp").on("click",function(){window.location.href="/help/trade"}),$("#goConfirm").on("click",function(){a.goSurePage()}),$(".goDetail,.closeBtn").on("click",e)});