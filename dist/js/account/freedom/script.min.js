$(function(){var t=new Page,e={};t.moneyRegex=/^[0-9]{1}[\d]*\.?[\d]{0,2}$/;var a=constant().clientType,n=constant().sessionKey;t.currentMoney,t.initpaging1=function(e,a){function n(e){t.getdetailin(e)}$("#pages1").paging({totalSize:e,currPage:a,turnSize:10,pageSize:10,callback:n})},t.initpaging2=function(e,a){function n(e){t.getdetailout(e)}$("#pages2").paging({totalSize:e,currPage:a,turnSize:10,pageSize:10,callback:n})},t.initpaging3=function(e,a){function n(e){t.getdetailprofit(e)}$("#pages3").paging({totalSize:e,currPage:a,turnSize:10,pageSize:10,callback:n})},t.getprofit=function(){function e(e){if(t.isSuccess(e)){var e=e.data;t.currentMoney=e.pcCurrentProductAccountInfo.balance,t.initTemplate(e,"freedomprofit","tempfreedomtop"),0==t.currentMoney&&$("#freedomout").addClass("disabled").attr("disabled","disabled")}}function i(e){if(t.isSuccess(e)){var e=e.data,a=$("#chartform")[0],n=echarts.init(a);option={tooltip:{trigger:"axis"},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:[e.pcCurrentProductLast7DayIncomeList[0].createDate,e.pcCurrentProductLast7DayIncomeList[1].createDate,e.pcCurrentProductLast7DayIncomeList[2].createDate,e.pcCurrentProductLast7DayIncomeList[3].createDate,e.pcCurrentProductLast7DayIncomeList[4].createDate,e.pcCurrentProductLast7DayIncomeList[5].createDate,e.pcCurrentProductLast7DayIncomeList[6].createDate]}],yAxis:[{type:"value"}],series:[{name:"收益",type:"line",stack:"总量",itemStyle:{normal:{areaStyle:{type:"default"}}},data:[e.pcCurrentProductLast7DayIncomeList[0].income,e.pcCurrentProductLast7DayIncomeList[1].income,e.pcCurrentProductLast7DayIncomeList[2].income,e.pcCurrentProductLast7DayIncomeList[3].income,e.pcCurrentProductLast7DayIncomeList[4].income,e.pcCurrentProductLast7DayIncomeList[5].income,e.pcCurrentProductLast7DayIncomeList[6].income]}]},n.setOption(option)}}function s(){function e(){var e=$(".common-cover"),a=$("#flowout");e.addClass("show"),a.addClass("show"),$("#currentMoney").html(strUtil().formatKilo(t.currentMoney)),$(".close").on("click",function(){var e=$(this).parents(".component");t.hideDialog(e)}),$("#txtMoney[readonly!='readonly']").on("blur",function(){_this=$(this);var e=_this.parent().parent(),a=e.find(".validation"),n="validate-success",i="validate-failed";validate().vd(_this,e,a,n,i,!1),t.operateMoney(_this,e,a)}),$("#txtMoney[readonly!='readonly']").on("focus",function(){var t=$(this).parent().parent();t.removeClass(validate().vdFailed);var e=t.find(".validation");e.html(""),$("#loginTip").hide()}),$("#submit").on("click",function(){var e=$("#txtMoney[readonly!='readonly']");return user().testSubmit(t.operateMoney,e),0==$("#outForm").find(".validate-failed").length&&void t.outCurrent()})}function a(){var e=t.get("isCanBuySXT");if(e){t.initBuy();var a=$(".common-cover"),n=$("#buy");a.addClass("show"),n.addClass("show")}else $(".noIvest").addClass("selected")}$("#freedomout").on("click",e),$("#freedomin").on("click",a)}return t.getData("/account/current/homepage",{clientType:a,sessionKey:n},[e,i,s])},t.getdetailin=function(e){function i(a){if(t.isSuccess(a)){var a=a.data;t.initTemplate(a,"detailin","temptablein"),t.initpaging1(a.totalCount,e)}}function s(e){if(t.isSuccess(e)){var e=e.data.currentList;e.length<=0&&($("#nolist1").show(),$("#pages1").hide())}}function o(){$(".inAgree").on("click",function(){t.contract($(this))})}return t.getData("/account/current/order",{clientType:a,sessionKey:n,type:"ZR",currentPage:e,pageSize:10},[i,s,o])},t.getdetailout=function(e){function i(a){if(t.isSuccess(a)){var a=a.data;t.initTemplate(a,"detailout","temptableout"),t.initpaging2(a.totalCount,e)}}function s(e){if(t.isSuccess(e)){var e=e.data.currentList;e.length<=0&&($("#nolist2").show(),$("#pages2").hide())}}return t.getData("/account/current/order",{clientType:a,sessionKey:n,type:"ZC",currentPage:e,pageSize:10},[i,s])},t.getdetailprofit=function(e){function i(a){if(t.isSuccess(a)){var a=a.data;t.initTemplate(a,"detailprofit","temptabledetail"),t.initpaging3(a.totalCount,e)}}function s(e){if(t.isSuccess(e)){var e=e.data.currentIncomeList;e.length<=0&&($("#nolist3").show(),$("#pages3").hide())}}return t.getData("/user/current/incomeList",{clientType:a,sessionKey:n,pageSize:10,currentPage:e},[i,s])},t.actiontab=function(){var t=$("#itemtap"),e=$("#itemtap .item"),a=[],n=$("#contenttable");e.each(function(t,e){a.push($(e).data("content"))}),a=a.join(" "),t.on("click",function(t){var i=$(t.target);i.hasClass("item")&&(e.removeClass("selected"),i.addClass("selected"),n.removeClass(a).addClass(i.data("content")))})},t.leftnav=function(){for(var t=location.pathname,e=$("#leftnav .item"),a=0,n=e.length;a<n;a++)e[a].href.indexOf(t)!=-1&&(e[a].className="selected item")},t.operateMoney=function(e,a,n){if(!a.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0){var i=parseFloat(strUtil().trim(e.val()));if(i>t.currentMoney)return a.addClass("validate-failed").removeClass("validate-success"),void n.html("转出金额不能大于账户可转金额");a.addClass("validate-success").removeClass("validate-failed"),$("#realityMoney").html(i+"元")}},t.initProp=function(a){function n(a){t.isSuccess(a)&&(a=a.data,t.set("productId",a.productId),t.set("productRemainAmount",a.productRemainAmount),e.annualIncomeText=parseFloat(a.annualIncomeText))}return t.getData("/product/sxtDetail",{clientType:"PC"},[n])},t.initBuy=function(){function a(a){t.isSuccess(a)&&(a=a.data,a.productRemainAmount=t.get("productRemainAmount"),a.buyTime=dateUtil().formatDate("yyyy-MM-dd"),t.initTemplate(a,"buy","tempBuy"),t.set("usableBalance",a.usableBalance),e.productRemainAmount=a.productRemainAmount,e.usableBalance=a.usableBalance,e.buyTime=a.buyTime)}function n(){function a(){var t=$(".common-cover"),e=$("#buy");t.removeClass("show"),e.removeClass("show")}function n(){var a=$("#amount").val(),n=$("#amount").parents(".row").eq(0),s=+t.get("usableBalance"),o=+t.get("productRemainAmount");i=!1,""===a?(n.removeClass("validate-success").addClass("validate-failed"),i=!1,$("#amount-validate").text("请输入正确金额")):isNaN(a)?(n.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("请输入正确金额"),i=!1):t.moneyRegex.test(a)?+a>s?(n.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("个人账户余额不足，请").append($("<a>").attr({href:"/html/account/bank",target:"_blank"}).addClass("link").text("充值")),i=!1):+a>o?(n.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最多可投"+o+"元"),i=!1):parseFloat(a)<1?(n.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最小起投金额为1元"),i=!1):(n.removeClass("validate-failed").addClass("validate-success"),$("#amount-validate").text(""),$("#actual").text(Util.padFloatMoney(a||0)+"元"),t.set("buyAmount",a),e.buyAmount=parseFloat(a),e.buyTime=dateUtil().formatDate("yyyy-MM-dd"),i=!0):(n.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("输入金额只能2位小数"),i=!1)}var i=!1;$("#buyClose").on("click",a),$("#amount").on("blur",function(a){var n=$(this).val(),s=$(this).parents(".row").eq(0),o=+t.get("usableBalance"),c=+t.get("productRemainAmount");""===n?(s.removeClass("validate-success validate-failed"),i=!1):isNaN(n)?($(this).parents(".row").eq(0).removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("请输入正确金额"),i=!1):+n>o?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("个人账户余额不足,请").append($("<a>").attr({href:"/html/account/bank",target:"_bank"}).addClass("link").text("充值")),$(".link").on("click",function(){window.location.reload()}),i=!1):+n>c?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("产品剩余可投金额不足"),i=!1):parseFloat(n)<1?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最小起投金额为1元"),i=!1):($(this).parents(".row").eq(0).removeClass("validate-failed").addClass("validate-success"),$("#amount-validate").text(""),$("#actual").text(Util.padFloatMoney(n)+"元"),t.set("buyAmount",n),e.buyAmount=parseFloat(n),i=!0)}),$("#btnBuy").on("click",function(a){return n(),!!i&&void t.post("/html/product/current/confirm",e)})}return t.getData("/user/totalAccount",{},[a,n])},t.initUser=function(){function e(e){t.isSuccess(e)&&(e=e.data,t.set("isCanBuySXT",1===e.isCanBuySXT))}return t.getData("/user/userIsBuyProduct",{},[e])},t.outCurrent=function(){function e(e){var a={};t.isSuccess(e)?a.isSuccess=!0:(a.isSuccess=!1,a.message=e.resultMessage),t.post("/html/account/roll-out",a)}var a=parseFloat(strUtil().trim($("#txtMoney").val()));return t.getData("/product/current/extract",{order_amount:a},[e])},t.contract=function(t){var e=t.attr("data-id"),a={isSXT:"1",orderNo:e};user().goNewPage(a,"10")},t.init=function(){t.setTitle("我的随心投"),user().loginOperate(),t.initProp(),t.getprofit(),t.getdetailin(),t.getdetailout(),t.getdetailprofit(),t.actiontab(),t.initUser()},t.init()});