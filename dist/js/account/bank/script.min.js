$(function(){function e(){$(this).parents(".open-close").hide(),$("#txtRechargeMoney").val("").focus()}var t=new Page;t.recharge=document.getElementById("recharge"),t.withDraw=document.getElementById("withDraw"),t.showCon=document.getElementById("showCon"),t.bankList=[],t.bankInfo={},t.bankName,t.isPsd,t.noPassword=!1,t.gateId,t.bindBankInfo={},t.accountInfo={},t.isFee,t.deductionCoin,t.getAccountInfo=function(){function e(e){t.isSuccess(e)&&(t.accountInfo=e.data,0==t.accountInfo.freeCount?t.accountInfo.birdCoin<2?(t.isFee=!0,t.deductionCoin=0):(t.isFee=!1,t.deductionCoin=2):(t.isFee=!1,t.deductionCoin=0),t.initTemplate(t.accountInfo,"depostInfo","templateDepostInfo"))}function a(){$("#userMoney").html("￥"+t.accountInfo.amount+"元")}return t.getData("/account/center/accountInfo",{},[e,a])},t.getBankList=function(){function e(e){if(t.isSuccess(e))e=e.data.bankList,t.initTemplate(e,"bankList","templateBankList"),t.pushBankList(e);else{user().testResultCode(e.resultCode)}$(".list .choose-bank:lt(7) .icon1").css("display","block")}return t.getData("/bank/list/online",{},[e,t.bindBankList])},t.getQuicklyBankList=function(){function e(e){if(t.isSuccess(e))e=e.data.list,t.pushQuicklyBankList(e);else{var a=user().testResultCode(e.resultCode);alert(a)}}return t.getData("/bank/list/bk",{},[e])},t.pushQuicklyBankList=function(e){if(e.length>0)for(var a=0;a<e.length;a++)t.bankInfo[e[a].bankName]=e[a]},t.pushBankList=function(e){var a={};if(a.limitationList={},e.length>0)for(var n=0;n<e.length;n++)a={},a.limitationList=e[n].limitationList,a.bankCode=e[n].bankCode,a.bankDes=e[n].bankDes,a.bankName=e[n].bankName,a.id=e[n].id,t.bankList.push(a)},t.changeBankRemark=function(e){t.bankList.length>0&&e<=t.bankList.length&&($("#bankTable").show(),$("#bankTip").show(),t.initTemplate(t.bankList[e].limitationList,"bankRemark","templateBankRemark"),t.initTemplate(t.bankList[e].bankDes,"bankTip","templateBankTip"))},t.initState=function(){var e=urlUtil().get("control");if("recharge"==e||""==e){t.recharge.className="item selected",t.withDraw.className="item";var a="charg-depost current1";t.showCon.className=a}else{t.recharge.className="item",t.withDraw.className="item selected";var a="charg-depost current2";t.showCon.className=a}user().isBindCard()?($("#quickBank").removeClass("hide"),$("#bindedCard").show(),user().isAgreementCZ()&&($("#onState").hide(),t.isPsd=!0),t.getBIndCardInfo()):$("#noBindCard").show()},t.changeNav=function(e,a){if("item selected"!=e.className){e.className="item selected";var n;"type1"==a?(t.withDraw.className="item",n="charg-depost current1"):(t.recharge.className="item",n="charg-depost current2"),t.showCon.className=n}},t.changeRecharge=function(e){for(var t=document.querySelectorAll(".recharge"),a=e.getAttribute("data-type"),n=document.getElementById("chargeWay"),i="recharge",o=0;o<t.length;o++)t[o]==e?(i=e.className,e.className="recharge selected","interBank"==a?n.className="chargeway ebank":n.className="chargeway quickly"):"recharge hide"==t[o].className?t[o].className="recharge hide":t[o].className="recharge"},t.changeRecharge2=function(e){return function(){t.changeRecharge(e)}},t.bindRecharge=function(){for(var e=document.querySelectorAll(".recharge"),a=0;a<e.length;a++)e[a].addEventListener("click",t.changeRecharge2(e[a]),!1)},t.changeBank=function(e){var a=document.querySelectorAll(".choose-bank"),n=e.getAttribute("data-index");t.gateId=e.getAttribute("data-code");for(var i=0;i<a.length;i++)a[i]==e?(e.className="choose-bank selected",t.changeBankRemark(n)):a[i].className="choose-bank"},t.changeBank2=function(e){return function(){t.changeBank(e)}},t.bindBankList=function(){for(var e=document.querySelectorAll(".choose-bank"),a=0;a<e.length;a++)e[a].addEventListener("click",t.changeBank2(e[a]),!1)},t.getBIndCardInfo=function(){function e(e){if(t.isSuccess(e))t.bankName=e.data.belongBank,e=e.data,t.bindBankInfo=e,t.initTemplate(e,"cardModel","templateCardModel"),t.initTemplate(e,"cardModel2","templateCardModel");else{var a=user().testResultCode(e.resultCode);alert(a)}}function a(){var e=t.bankInfo[t.bankName];void 0!=e&&($("#onceTimeMoney").html(e.chargeTimeLimit),$("#onceDayMoney").html(e.chargeDateLimit))}return t.getData("/account/center/bankInfo",{},[e,a])},t.largeRecharge=function(){var e=$("#txtRechargeMoney").val(),a={gateId:t.gateId,orderAmount:e};user().goNewPage(a,"1"),$("#largeRechargePopup").show()},t.quicklyRechargeNoPsd=function(){var e=$("#txtRechargeMoney").val(),t={orderAmount:e};user().goNewPage(t,"3"),$("#shortRechargePopup").show()},t.quicklyRechargeHasPsd=function(){var e={agreement_type:"ZCZP0800",unbind:"0"};user().goNewPage(e,"4"),$("#noPsdPopup").show()},t.quicklyRechargeSure=function(){t.goSurePage()},t.goSurePage=function(){var e="/html/account/confirmation",a=$("#txtRechargeMoney").val();t.bindBankInfo.money=a,t.post(e,t.bindBankInfo),window.location.href=e},t.addEvent=function(e,a,n){if("txtWithdraw"==e.attr("id")){if(strUtil().trim(e.val()).length>0&&!isNaN(parseFloat(e.val()))){var i=parseFloat(e.val()),o=parseFloat(t.accountInfo.amount);t.isFee?i<=2&&o<=2?(a.addClass("validate-failed").removeClass("validate-success"),n.html("你的金额小于等于2元,请等待下个月提现")):i+2>o?(a.addClass("validate-failed").removeClass("validate-success"),n.html("提现金额超出可用余额")):i+2<=o&&($("#actualMoney").text(i),a.addClass("validate-success").removeClass("validate-failed"),n.html("")):i>o?(a.addClass("validate-failed").removeClass("validate-success"),n.html("提现金额超出可用余额")):($("#actualMoney").text(i),a.addClass("validate-success").removeClass("validate-failed"),n.html(""))}else $("#actualMoney").text("");return!1}},t.testWithDraw=function(){var e=$("#actualMoney").html().replace("元",""),a=t.deductionCoin,n={orderAmount:e,birdCoin:a};user().goNewPage(n,"2"),$("#noPsdPopup").show(),$("#withDrawPopup").show()},$(".card").on("click",function(){window.location.href="/html/account/card1/"}),t.leftnav=function(){for(var e=location.pathname,t=$("#leftnav .item"),a=0,n=t.length;a<n;a++)t[a].href.indexOf(e)!=-1&&(t[a].className="selected item")},t.init=function(){t.setTitle("我的银行卡"),user().loginOperate(),user().isNameAuth()||(window.location.href="/html/account/realname/"),user().updateUserInfo(),t.getAccountInfo(),t.when(t.getBankList,[t.getQuicklyBankList,t.initState,function(){t.recharge.addEventListener("click",function(){t.changeNav(this,"type1")},!1),t.withDraw.addEventListener("click",function(){t.changeNav(this,"type2")},!1)}]),t.bindRecharge()},t.init(),$("input[data-type=money]").on("blur",function(){_this=$(this);var e=_this.parent().parent(),a=e.find(".validation"),n="validate-success",i="validate-failed";validate().vd(_this,e,a,n,i,!1),t.addEvent(_this,e,a)}),$("#txtWithdraw").on("input",function(){_this=$(this);var e=_this.parent().parent(),a=e.find(".validation");t.addEvent(_this,e,a)}),$("input[data-type=money]").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var t=e.find(".validation");t.html(""),$("#loginTip").hide()}),$("#submit").on("click",function(){return user().testSubmit(),0==$("#form").find(".validate-failed").length&&void(0==$("#bankList").find(".selected").length?alert("请选择银行"):t.largeRecharge())}),$("#submit2").on("click",function(){if(user().testSubmit(),0!=$("#form").find(".validate-failed").length)return!1;var e=t.bankInfo[t.bankName],a=parseFloat($("#txtRechargeMoney").val());return a>parseFloat(e.chargeTimeLimit)?void alert("订单金额超出单笔限额"):void(t.isPsd?t.quicklyRechargeSure():t.noPassword?t.quicklyRechargeHasPsd():t.quicklyRechargeNoPsd())}),$("#submit3").on("click",function(){return user().testSubmit(t.addEvent),0==$("#form2").find(".validate-failed").length&&void t.testWithDraw()}),$("#switch").on("click",function(){var e=$(this);e.hasClass("selected")?(e.removeClass("selected"),t.noPassword=!1,$("#switchStatus").text("(关闭状态)")):(e.addClass("selected"),t.noPassword=!0,$("#switchStatus").text("(开启状态)"))}),$("#largeRechargePopup .goCenter").on("click",function(){window.location.href="/html/account/detail/?control=detailCharge"}),$("#withDrawPopup .goCenter").on("click",function(){window.location.href="/html/account/detail/?control=detailWithDraw"}),$(".goHelp").on("click",function(){window.location.href="/help/trade"}),$("#goConfirm").on("click",function(){t.goSurePage()}),$(".goDetail,.closeBtn").on("click",e)});