$(function(){function isEmptyObject(e){var t;for(t in e)return!1;return!0}function mutilPreProfit(e,t,a){return e=Number(e),t=Number(t),a=Number(a),e*t*a/360}function moreProfit(e,t){return"JXQ"==t.type?e+e*t.amount/100:"TZFX"==t.type?e+t.amount:e}var baseUrl=Config.baseUrl,page=new Page;page.prodInfo={},page.buyInfo={},page.birdCoin=0,page.coupons=[];var postData={};page.oldMoney=0;var userStatus=session().get("userStatus"),userType=session().get("userType"),secondCategoryId;page.getNotic=function(){function e(e){"0"===e.resultCode&&(e=e.data,page.initTemplate(e,"crumb","tempCrumb"))}function t(){$("#marquee").marquee({yScroll:"bottom"})}return page.getData("/message/getScrollMessage",{clientType:"PC"},[e,t])},page.getLCTXL=function(e){function t(e){"0"==e.resultCode&&(e=e.data,secondCategoryId=secondCategoryId=e.pcProductDetail.secondCategoryId,page.set("productId",e.pcProductDetail.productId),$(".JS-shopStages,.JS-supply,.JS-cashStages").hide(),$(".JS-common").show(),page.setTitle(e.pcProductDetail.productTag))}function a(e){"0"===e.resultCode&&(e=e.data,page.prodInfo=e,postData.productName=e.pcProductDetail.productName,postData.convertDay=e.pcProductDetail.convertDay,postData.annualIncomeText=e.pcProductDetail.annualIncomeText,postData.annualIncome=e.pcProductDetail.annualIncome,postData.repaymentType=e.pcProductDetail.repaymentType,postData.staRateDate=e.pcProductDetail.staRateDate,postData.endDate=e.pcProductDetail.endDate,postData.useBirdCoinTag=e.pcProductDetail.useBirdCoinTag,postData.useCouponTag=e.pcProductDetail.useCouponTag,page.initTemplate(e.pcProductDetail,"longProp","tempLongprop"))}function o(e){if("0"===e.resultCode){e=e.data.pcProductDetail;var t=$("#chartProcess")[0],a=echarts.init(t);a.setOption({series:{name:"项目进度",type:"pie",radius:["80%","100%"],label:{normal:{show:!1}},data:[{value:parseInt(e.progress),name:"已完成",itemStyle:{normal:{color:"#ff6f20"}}},{value:100-parseInt(e.progress),name:"剩余",itemStyle:{normal:{color:"#e2e2e2"}}}]}})}}function n(e){function t(){user().loginOperate(o())}function a(){page.when(page.getCoupons,[page.getBuyPopup]);var e=$(".common-cover"),t=$("#buyDialog");e.addClass("show"),t.addClass("show")}function o(){return function(){"1"==userType?"-1"==userStatus?window.location.href="/html/user/corporate_fail/":"0"==userStatus?window.location.href="/html/user/corporate_success/":"2"==userStatus?window.location.href="/html/user/corporate_realname1/":"1"==userStatus&&user().nameAuthOperate(a):user().nameAuthOperate(a)}}if($("#invest").on("click",t),"10000006"===e.resultCode)return session().clear(),void user().loginOperate()}var i=page.get("productId");return postData.productId=i,page.getData("/product/productDetail",{clientType:"PC",id:i},[t,a,o,n])},page.getLCTXQ=function(e){function t(e){"0"===e.resultCode&&(e=e.data.pcProductIntroduceD,e.secondCategoryId=secondCategoryId,page.initTemplate(e,"itemDetail","tempItemDetail"))}function a(e){var e=e.data.pcProductIntroduceD.pcProjectUse;""==e?($("#zichan").hide(),$("#fengkong").hide()):($("#infoXQ").hide(),$("#zichan").show(),$("#fengkong").show())}var o=page.get("productId");return page.getData("/product/productIntroduceD",{clientType:"PC",id:o},[t,a])},page.pagDesc=function(){function e(e){page.getDesc(e)}$(".pages").paging({totalSize:page.get("totalCount"),turnSize:5,pageSize:10,currPage:page.get("currPage"),callback:e})},page.getDesc=function(e){function t(e){"0"===e.resultCode&&(e=e.data,page.initTemplate(e,"desc","tempDesc"))}function a(e){"0"===e.resultCode&&(e=e.data,page.set("totalCount",e.totalCount)),page.pagDesc()}function o(){var e=$("#descTab"),t=$("#descTab .item"),a=[],o=$("#contentTab");t.each(function(e,t){a.push($(t).data("content"))}),a=a.join(" "),e.on("click",function(e){var n=$(e.target);n.hasClass("item")&&(t.removeClass("selected"),n.addClass("selected"),o.removeClass(a).addClass(n.data("content")))}),$(".action").mouseover(function(){$(this).find(".blueIcon").show(),$(this).find(".tankuang").show()}),$(".action").mouseout(function(){$(this).find(".blueIcon").hide(),$(this).find(".tankuang").hide()})}if(page.set("currPage",e),user().isLogin())return $("#logCont").css("display","block"),$(".nolist").css("display","none"),$(".accountpage").css("display","block"),page.getData("/product/purchasehistory",{clientType:"PC",currentPage:e||0,pageSize:10,productId:page.get("productId")},[t,a,o]);$("#logCont").css("display","none"),$(".nolist").css("display","block"),$(".accountpage").css("display","none");var n=$("#descTab"),i=$("#descTab .item"),s=[],r=$("#contentTab");i.each(function(e,t){s.push($(t).data("content"))}),s=s.join(" "),n.on("click",function(e){var t=$(e.target);t.hasClass("item")&&(i.removeClass("selected"),t.addClass("selected"),r.removeClass(s).addClass(t.data("content")))}),$(".action").mouseover(function(){$(this).find(".blueIcon").show(),$(this).find(".tankuang").show()}),$(".action").mouseout(function(){$(this).find(".blueIcon").hide(),$(this).find(".tankuang").hide()}),$("#login2").on("click",function(){user().loginOperate()})},page.getBuyPopup=function(){function e(e){"0"===e.resultCode&&(e=e.data,page.buyInfo.prodInfo=page.prodInfo,page.buyInfo.userInfo=e,postData.productRemainAmount=e.usableBalance,postData.isNoPwdTZ=e.isNoPwdTZ,postData.useBirdCoinTag=page.buyInfo.prodInfo.pcProductDetail.useBirdCoinTag,postData.useCouponTag=page.buyInfo.prodInfo.pcProductDetail.useCouponTag,postData.annualIncome=page.buyInfo.prodInfo.pcProductDetail.annualIncome,postData.convertDay=page.buyInfo.prodInfo.pcProductDetail.convertDay,page.getCoupons(e.coupons),page.initTemplate(page.buyInfo,"buyDialog","tempIateBuyPopup"),page.operateEndMoney())}function t(){function e(){var e=$(".common-cover"),t=$("#buyDialog");e.removeClass("show"),t.removeClass("show"),page.oldMoney=0,page.birdCoin=0}$("#txtMoney[readonly!='readonly']").on("blur",function(){_this=$(this);var e=_this.parent().parent(),t=e.find(".validation"),a="validate-success",o="validate-failed";validate().vd(_this,e,t,a,o,!1),page.operateMoney(_this,e,t)}),$("#txtMoney[readonly!='readonly']").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var t=e.find(".validation");t.html(""),$("#loginTip").hide()}),$("#submit").on("click",function(){var e=$("#txtMoney[readonly!='readonly']");if(user().testSubmit(page.operateMoney,e),0!=$("#form").find(".validate-failed").length)return!1;var t=strUtil().trim($("#txtMoney").val()),a=0,o=$("#isUse");"checked"!=o.attr("checked")&&"true"!=o.attr("checked")||(a=$("#birdCoin").html());var n="请选择..."==$("#couponList").val()?"0":$("#couponList").val(),i=$("#couponList option:selected").text(),s=$("#amountMoney").html().replace("元",""),r=$("#yuqiAmount").data("code")||"",u=$("#yuqiAmount").data("amount");postData.buyAmount=t,postData.usedCoin=a,$("#code").hasClass("pitch")?(postData.presentCode=r,postData.usedCouponText=u,postData.couponId=""):(postData.couponId=n,postData.presentCode="",postData.usedCouponText=i),postData.amountMoney=s,page.post("./confirm",postData)}),$("#buyDialogClose").on("click",e),$("#isUse").on("click",function(){var e=isNaN(parseFloat(strUtil().trim($("#txtMoney").val())))?"0":parseFloat(strUtil().trim($("#txtMoney").val())),t=$(this);"checked"==t.attr("checked")||"true"==t.attr("checked")?t.removeAttr("checked"):t.attr("checked","checked"),page.countPayMoney(e)})}function a(){$(".radio").on("click",function(){var e=$(this).parent().attr("class");$("#couponList").find("option:first").attr("selected",!0).siblings().attr("selected",!1),$("#presentCode").val(""),$("#code").attr("class","code"),$("#yuqiAmount").html(""),"tickits"==e?($("#couponList").addClass("pitch"),$("#code").removeClass("pitch")):($("#code").addClass("pitch"),$("#couponList").removeClass("pitch"),$("#code #presentCode").on("blur",function(){page.getCode()}))})}var o=page.get("productId");return page.getData("/user/userInfo",{productId:o},[e,t,a])},page.operateEndMoney=function(){var e=$("#txtMoney"),t=e.parent().parent(),a=t.find(".validation"),o=parseFloat(page.buyInfo.prodInfo.pcProductDetail.staInvestAmount),n=parseFloat(page.buyInfo.prodInfo.pcProductDetail.productRemainAmount);n<=o&&(e.attr("readonly","readonly"),e.val(n),t.addClass("validate-success").removeClass("validate-failed"),a.html("最后一笔投资只能为剩余金额"),page.countBirdCoin(n),page.countPayMoney(n))},page.operateMoney=function(_this,vdRow,vdTip){function roundNum(number,fDigits){with(Math)return round(number*pow(10,fDigits))/pow(10,fDigits)}function mutilRealAmount(e){return e<=endMoney?userMoney>=e?(vdRow.addClass("validate-success").removeClass("validate-failed"),page.countBirdCoin(e),page.countPayMoney(e),void(e!=page.oldMoney&&($("#couponList").length>0&&page.initCoupons(e),page.oldMoney=e))):(vdRow.addClass("validate-failed").removeClass("validate-success"),vdTip.text("个人账户余额不足，请").append($("<a>").attr({href:"/html/account/bank",target:"_blank"}).addClass("link").text("充值")),void $(".link").on("click",function(){window.location.reload()})):(vdRow.addClass("validate-failed").removeClass("validate-success"),void vdTip.html("投资金额不能大于剩余金额"))}if(!vdRow.hasClass("validate-failed")&&strUtil().trim(_this.val()).length>0){var money=parseFloat(_this.val()),startMoney=parseFloat(page.buyInfo.prodInfo.pcProductDetail.staInvestAmount),endMoney=parseFloat(page.buyInfo.prodInfo.pcProductDetail.productRemainAmount),userMoney=parseFloat(page.buyInfo.userInfo.usableBalance),danbiMoney=parseFloat(page.buyInfo.prodInfo.pcProductDetail.singleLimitAmount),annualIncome=page.buyInfo.prodInfo.pcProductDetail.annualIncome,convertDay=page.buyInfo.prodInfo.pcProductDetail.convertDay;if(money<startMoney)return vdRow.addClass("validate-failed").removeClass("validate-success"),void vdTip.html("投资金额必须大于起投金额");if(danbiMoney>0&&money>danbiMoney)return vdRow.addClass("validate-failed").removeClass("validate-success"),void vdTip.html("输入的金额超过了单笔投资上限");mutilRealAmount(money);var profit=roundNum(mutilPreProfit(money,annualIncome,convertDay),2);page.set("profit",profit);var opeitonEd=$("#couponList").find("option:selected").data();opeitonEd&&(profit=roundNum(moreProfit(profit,opeitonEd),2)),$(".preprofittwo").text(profit)}},page.getCode=function(){function e(e){if("0"===e.resultCode){var e=e.data;$("#yuqiAmount").attr("data-code",t),$("#yuqiAmount").attr("data-amount",e.coupon.couponName),$("#yuqiAmount").html("+"+e.coupon.couponName),$("#code").addClass("vaid-success").removeClass("valid-fail")}else $("#code").addClass("valid-fail").removeClass("vaid-success"),$("#code .valid .validTips").html(e.resultMessage)}var t=$("#presentCode").val();return page.getData("/pc/account/fxq/couponInfo/get",{presentCode:t},[e])},page.getCoupons=function(e){var t,a,o=[],n=e&&e.length||0;for(a=0;a<n;a++)t=e[a],"YX"===t.status&&"TYDK"!==t.activityType&&o.push({id:t.userCouponId,name:t.couponName,type:t.activityType,expired:t.couponDate,limit:t.limitAmount,amount:t.amount});page.coupons=o},page.initCoupons=function(e){page.initTemplate(a,"couponList","tempCoupons");for(var t,a=page.filterCoupons(e),o=+$("#txtMoney").val()||0,n=$("#couponList"),i=[$("<option>").text("请选择...")],s=0,r=a.length;s<r;s++)t=a[s],t.limit<=o&&(i.push($("<option data-type="+t.type+" data-amount="+t.amount+">").attr("value",t.id).text(t.name)),n.empty().append(i));0==r&&(i.shift(),i.push($("<option>").attr("value","").text("暂无可用券...")),n.empty().append(i)),n.unbind("change").bind("change",function(){var e=$("#couponList").find("option:selected").data(),t=$("#couponList").find("option:selected").html();isEmptyObject(e)?$("#yuqiAmount").html(""):$("#yuqiAmount").html("+"+t)})},page.filterCoupons=function(e){for(var t,a=[],o=0;o<page.coupons.length;o++)t=page.coupons[o],e>=t.limit&&a.push(t);return a},page.countBirdCoin=function(e){var t=parseInt(100*parseFloat(page.buyInfo.userInfo.birdCoin))/100,a=parseInt(e/50*100)/100;t>=a?($("#birdCoin").html(a),$("#birdDeductionMoney").html(a),page.birdCoin=a):($("#birdCoin").html(t),$("#birdDeductionMoney").html(t),page.birdCoin=t)},page.countPayMoney=function(e){var t=e,a=$("#isUse").attr("checked");t="checked"==a||"true"==a?e-page.birdCoin:e,t=0==t?"0.00":t,$("#amountMoney").html(t+"元")},page.init=function(){page.set("productId",Url.getHashParts(0)),page.getNotic(),page.when(page.getLCTXL,[page.getLCTXQ]),page.when(page.getDesc,[page.pagDesc])},page.init()});