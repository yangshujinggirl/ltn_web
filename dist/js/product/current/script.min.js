$(function(){var a=new Page,e={};a.moneyRegex=/^[0-9]{1}[\d]*\.?[\d]{0,2}$/,a.initUser=function(){function e(e){a.isSuccess(e)&&(e=e.data,a.set("isCanBuySXT",1===e.isCanBuySXT))}return a.getData("/user/userIsBuyProduct",{},[e])},a.initCrumb=function(){function e(e){a.isSuccess(e)&&(e=e.data,a.initTemplate(e,"crumb","tempCrumb"))}function t(){$("#marquee").marquee({yScroll:"bottom"})}return a.getData("/message/getScrollMessage",{clientType:"PC"},[e,t])},a.initProp=function(t){function s(t){a.isSuccess(t)&&(t=t.data,a.set("productId",t.productId),a.set("productRemainAmount",t.productRemainAmount),e.annualIncomeText=parseFloat(t.annualIncomeText))}function n(e){a.isSuccess(e)&&(e=e.data,a.initTemplate(e,"prop","tempProp"))}function i(e){if(a.isSuccess(e)){e=e.data;var t=$("#chartProcess")[0],s=echarts.init(t);s.setOption({series:{name:"项目进度",type:"pie",radius:["80%","100%"],label:{normal:{show:!1}},data:[{value:e.progress,name:"已完成",itemStyle:{normal:{color:"#ff6f20"}}},{value:100-e.progress,name:"剩余",itemStyle:{normal:{color:"#e2e2e2"}}}]}})}}function o(){function e(){user().loginOperate(t())}function t(){return function(){user().nameAuthOperate(s)}}function s(){a.when(a.initUser,[a.initBuy,n])}function n(){var e=a.get("isCanBuySXT");if(e){var t=$(".common-cover"),s=$("#buy");t.addClass("show"),s.addClass("show")}else $("#invest").attr("disabled","disabled").addClass("disabled").html("您不符合购买条件")}$("#invest").on("click",e)}return a.getData("/product/sxtDetail",{clientType:"PC"},[s,n,i,o])},a.initLog=function(){function e(e){a.isSuccess(e)&&(e=e.data,a.initTemplate(e,"log","tempLog")),user().isLogin()?($("#logCont").css("display","block"),$(".nolist").css("display","none"),$(".accountpage").css("display","block")):($("#logCont").css("display","none"),$(".nolist").css("display","block"),$(".accountpage").css("display","none")),$("#login2").on("click",function(){user().loginOperate()})}function t(e){a.isSuccess(e)&&(e=e.data,$(".log .pages").paging({totalSize:e.totalCount,turnSize:10,currPage:a.get("currPage"),callback:s}))}function s(s){a.set("currPage",s),a.getData("/product/currentPurchasehistory",{productId:a.get("productId"),currentPage:s},[e,t])}function n(){var a=$("#descTab"),e=$("#descTab .item"),t=[],s=$("#contentTab");e.each(function(a,e){t.push($(e).data("content"))}),t=t.join(" "),a.on("click",function(a){var n=$(a.target);n.hasClass("item")&&(e.removeClass("selected"),n.addClass("selected"),s.removeClass(t).addClass(n.data("content")))})}return a.getData("/product/currentPurchasehistory",{productId:a.get("productId"),currentPage:a.get("pageNo")||0},[e,t,n])},a.initBuy=function(){function t(t){a.isSuccess(t)&&(t=t.data,t.productRemainAmount=a.get("productRemainAmount"),t.buyTime=dateUtil().formatDate("yyyy-MM-dd"),a.initTemplate(t,"buy","tempBuy"),a.set("usableBalance",t.usableBalance),e.productRemainAmount=t.productRemainAmount,e.usableBalance=t.usableBalance)}function s(){function t(){var a=$(".common-cover"),e=$("#buy");a.removeClass("show"),e.removeClass("show")}function s(){var t=$("#amount").val(),s=$("#amount").parents(".row").eq(0),i=+a.get("usableBalance"),o=+a.get("productRemainAmount");n=!1,""===t?(s.removeClass("validate-success").addClass("validate-failed"),n=!1,$("#amount-validate").text("请输入正确金额")):isNaN(t)?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("请输入正确金额"),n=!1):a.moneyRegex.test(t)?+t>i?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("个人账户余额不足，请").append($("<a>").attr({href:"/html/account/bank",target:"_blank"}).addClass("link").text("充值")),n=!1):+t>o?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最多可投"+o+"元"),n=!1):parseFloat(t)<1?(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最小起投金额为1元"),n=!1):(s.removeClass("validate-failed").addClass("validate-success"),$("#amount-validate").text(""),$("#actual").text(Util.padFloatMoney(t||0)+"元"),a.set("buyAmount",t),e.buyAmount=parseFloat(t),e.buyTime=dateUtil().formatDate("yyyy-MM-dd"),n=!0):(s.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("输入金额只能2位小数"),n=!1)}var n=!1;$("#buyClose").on("click",t),$("#amount").on("blur",function(t){var s=$(this).val(),i=$(this).parents(".row").eq(0),o=+a.get("usableBalance"),l=+a.get("productRemainAmount");n=!1,""===s?(i.removeClass("validate-success validate-failed"),n=!1):isNaN(s)?(i.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("请输入正确金额"),n=!1):a.moneyRegex.test(s)?+s>o?(i.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("个人账户余额不足，请").append($("<a>").attr({href:"/html/account/bank",target:"_blank"}).addClass("link").text("充值")),$(".link").on("click",function(){window.location.reload()}),n=!1):+s>l?(i.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("产品剩余可投金额不足"),n=!1):parseFloat(s)<1?(i.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最小起投金额为1元"),n=!1):(i.removeClass("validate-failed").addClass("validate-success"),$("#amount-validate").text(""),$("#actual").text(Util.padFloatMoney(s||0)+"元"),a.set("buyAmount",s),e.buyAmount=parseFloat(s),e.buyTime=dateUtil().formatDate("yyyy-MM-dd"),e.buyTime=n=!0):(i.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("输入金额只能2位小数"),n=!1)}),$("#btnBuy").on("click",function(t){return s(),!!n&&void a.post("./confirm",e)})}return a.getData("/user/totalAccount",{},[t,s])},a.init=function(){a.setTitle("随心投"),a.initCrumb(),a.when(a.initProp,[a.initLog])},a.init()});