$(function(){var e,t=new Page,a=session().get("userStatus"),o=session().get("userType"),n={};t.set("productId",Url.getHashParts(0)),t.buyInfo={},t.oldMoney=0,t.initShourtcuts=function(){function e(e){if(t.isSuccess(e)&&(e=e.data,t.set("isNoPwdTZ","1"==e.agreementTZ),!t.get("isNoPwdTZ")))return t.getData("/user/agreement",{agreement_type:"ZTBB0G00"},[a])}function a(e){t.isSuccess(e)&&(e=e.data,t.set("noPwdTZUrl",e.url))}return t.getData("/pc/user/info",{},[e])},t.getNotic=function(){function e(e){"0"===e.resultCode&&(e=e.data,t.initTemplate(e,"crumb","temprumb"))}function a(){$("#marquee").marquee({yScroll:"bottom"})}return t.getData("/message/getScrollMessage",{clientType:"PC"},[e,a])},t.getXSBProp=function(s){function r(e){"0"==e.resultCode&&(e=e.data,t.set("productId",e.pcProductDetail.productId))}function i(a){"0"===a.resultCode&&(a=a.data,e=a.pcProductDetail.secondCategoryId,t.prodInfo=a.pcProductDetail,n.productName=a.pcProductDetail.productName,n.convertDay=a.pcProductDetail.convertDay,n.annualIncomeText=a.pcProductDetail.annualIncomeText,n.repaymentType=a.pcProductDetail.repaymentType,n.staRateDate=a.pcProductDetail.staRateDate,n.productType=a.pcProductDetail.productType,n.endDate=a.pcProductDetail.endDate,t.initTemplate(a.pcProductDetail,"prop","tempProp"))}function c(e){if("0"===e.resultCode){e=e.data.pcProductDetail;var t=$("#chartProcess")[0],a=echarts.init(t);a.setOption({series:{name:"项目进度",type:"pie",radius:["80%","100%"],label:{normal:{show:!1}},data:[{value:e.progress,name:"已完成",itemStyle:{normal:{color:"#ff6f20"}}},{value:100-e.progress,name:"剩余",itemStyle:{normal:{color:"#e2e2e2"}}}]}})}}function l(){function e(){user().loginOperate(s())}function n(){t.getBuyPopup();var e=$(".common-cover"),a=$("#buy");e.addClass("show"),a.addClass("show")}function s(){return function(){"1"==o?"-1"==a?window.location.href="/html/user/corporate_fail/":"0"==a?window.location.href="/html/user/corporate_success/":"2"==a?window.location.href="/html/user/corporate_realname1/":"1"==a&&user().nameAuthOperate(r):user().nameAuthOperate(r)}}function r(){function e(e){"0"===e.resultCode&&(e=e.data,"1"==e.isCanBuyXSB?n():$("#invest").attr("disabled","disabled").addClass("disabled").html("您不符合购买条件"))}return t.getData("/user/userIsBuyProduct",{},[e])}function i(){var e=$(".common-cover"),t=$("#buy");e.removeClass("show"),t.removeClass("show")}$("#invest").on("click",e),$("#buyClose").on("click",i)}var d=t.get("productId");return n.productId=d,t.getData("/product/productDetail",{clientType:"PC",id:d},[r,i,c,l])},t.getLXSBXM=function(a){function o(a){"0"===a.resultCode&&(a=a.data.pcProductIntroduceS,a.secondCategoryId=e,console.log(a),t.initTemplate(a,"XSBdetail","tempDetail"))}var n=t.get("productId");return t.getData("/product/productIntroduceS",{clientType:"PC",id:n},[o])},t.pagDesc=function(){function e(e){t.getDesc(e)}$(".pages").paging({totalSize:t.get("totalCount"),turnSize:5,pageSize:10,currPage:t.get("currPage"),callback:e})},t.getDesc=function(e){function a(e){"0"===e.resultCode&&(e=e.data,t.initTemplate(e,"desc","tempDescXSB"))}function o(e){"0"===e.resultCode&&(e=e.data,t.set("totalCount",e.totalCount)),t.pagDesc()}function n(){var e=$("#tescXSBtab"),t=$("#tescXSBtab .item"),a=[],o=$("#contentXsbTab");t.each(function(e,t){a.push($(t).data("content"))}),a=a.join(" "),e.on("click",function(e){var n=$(e.target);n.hasClass("item")&&(t.removeClass("selected"),n.addClass("selected"),o.removeClass(a).addClass(n.data("content")))})}if(t.set("currPage",e),user().isLogin())return $("#logCont").css("display","block"),$(".nolist").css("display","none"),$(".accountpage").css("display","block"),t.getData("/product/purchasehistory",{clientType:"PC",currentPage:e||0,pageSize:10,productId:t.get("productId")},[a,o,n]);$("#logCont").css("display","none"),$(".nolist").css("display","block"),$(".accountpage").css("display","none");var s=$("#tescXSBtab"),r=$("#tescXSBtab .item"),i=[],c=$("#contentXsbTab");r.each(function(e,t){i.push($(t).data("content"))}),i=i.join(" "),s.on("click",function(e){var t=$(e.target);t.hasClass("item")&&(r.removeClass("selected"),t.addClass("selected"),c.removeClass(i).addClass(t.data("content")))}),$("#login2").on("click",function(){user().loginOperate()})},t.getBuyPopup=function(){function e(e){"0"===e.resultCode&&(e=e.data,t.buyInfo.prodInfo=t.prodInfo,t.buyInfo.userInfo=e,n.productRemainAmount=e.usableBalance,n.isNoPwdTZ=e.isNoPwdTZ,t.initTemplate(t.buyInfo,"form","tempBuy"),t.operateEndMoney())}function a(){$("#txtMoney[readonly!='readonly']").on("blur",function(){_this=$(this);var e=_this.parent().parent(),a=e.find(".validation"),o="validate-success",n="validate-failed";validate().vd(_this,e,a,o,n,!1),t.operateMoney(_this,e,a)}),$("#txtMoney[readonly!='readonly']").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var t=e.find(".validation");t.html(""),$("#loginTip").hide()}),$("#submit").on("click",function(){var e=$("#txtMoney[readonly!='readonly']");if(user().testSubmit(t.operateMoney,e),0!=$("#form").find(".validate-failed").length)return!1;var a=strUtil().trim($("#txtMoney").val()),o=$("#amountMoney").html().replace("元","");n.buyAmount=a,n.amountMoney=o,t.post("./confirm",n)})}return t.getData("/user/userInfo",{},[e,a])},t.operateEndMoney=function(){var e=$("#txtMoney"),a=e.parent().parent(),o=a.find(".validation"),n=parseFloat(t.buyInfo.prodInfo.staInvestAmount),s=parseFloat(t.buyInfo.prodInfo.productRemainAmount);s<=n&&(e.attr("readonly","readonly"),e.val(s),a.addClass("validate-success").removeClass("validate-failed"),o.html("最后一笔投资只能为剩余金额"),$("#amountMoney").html(s+"元"))},t.operateMoney=function(e,a,o){if(!a.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0){var n=parseFloat(e.val()),s=parseFloat(t.buyInfo.prodInfo.staInvestAmount),r=parseFloat(t.buyInfo.prodInfo.productRemainAmount),i=parseFloat(t.buyInfo.userInfo.usableBalance),c=parseFloat(t.buyInfo.prodInfo.convertDay);if(c<=10&&n>1e4)return a.addClass("validate-failed").removeClass("validate-success"),void o.html("新手标单次投资上限为10000元");if(n<s)return a.addClass("validate-failed").removeClass("validate-success"),void o.html("投资金额必须大于起投金额");if(!(n<=r))return a.addClass("validate-failed").removeClass("validate-success"),void o.html("投资金额不能大于剩余金额");if(!(i>=n))return a.addClass("validate-failed").removeClass("validate-success"),o.text("个人账户余额不足，请").append($("<a>").attr({href:"/html/account/bank",target:"_blank"}).addClass("link").text("充值")),void $(".link").on("click",function(){window.location.reload()});if(a.addClass("validate-success").removeClass("validate-failed"),t.oldMoney!=n)return $("#amountMoney").html(n+"元"),void(t.oldMoney=n)}},t.init=function(){t.setTitle("新手标"),t.getNotic(),t.when(t.getXSBProp,[t.getLXSBXM]),t.when(t.getDesc,[t.pagDesc])},t.init()});