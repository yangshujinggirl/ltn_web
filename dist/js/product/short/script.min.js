$(function(){function mutilPreProfit(e,o,n){return e=Number(e),o=Number(o),n=Number(n),e*o*n/360}function moreProfit(e,o){return"JXQ"==o.type?e+e*o.amount/100:"TZFX"==o.type?e+o.amount:e}function isEmptyObject(e){var o;for(o in e)return!1;return!0}var page=new Page,postData={};page.set("productId",Url.getHashParts(0)),page.isEnd;var userStatus=session().get("userStatus"),userType=session().get("userType");page.riskType1=[],page.riskType2=[],page.riskType3=[],page.riskType4=[],page.riskType5=[],page.riskType6=[],page.riskType7=[],page.riskType8=[],page.riskType9=[],page.riskType10=[],page.riskType11=[],page.riskType12=[],page.riskType13=[],page.riskType14=[],page.riskType15=[],page.riskType16=[],page.riskType17=[],page.riskType18=[],page.initShourtcuts=function(){function e(e){if(page.isSuccess(e)&&(e=e.data,page.set("isNoPwdTZ","1"==e.agreementTZ),!page.get("isNoPwdTZ")))return page.getData("/user/agreement",{agreement_type:"ZTBB0G00"},[o])}function o(e){page.isSuccess(e)&&(e=e.data,page.set("noPwdTZUrl",e.url),postData.noPwdTZUrl=e.url)}return page.getData("/pc/user/info",{},[e])},page.initUser=function(){function e(e){function o(e){var o,n,a=[],t=e&&e.length||0;for(n=0;n<t;n++)o=e[n],"YX"===o.status&&"TYDK"!==o.activityType&&a.push({id:o.userCouponId,name:o.couponName,type:o.activityType,expired:o.couponDate,limit:o.limitAmount,amount:o.amount});return a}page.isSuccess(e)&&(e=e.data,page.set("coupons",o(e.coupons)),page.set("coin",e.birdCoin),page.set("usableBalance",e.usableBalance))}var o=page.get("productId");return page.getData("/user/userInfo",{productId:o},[e])},page.initCrumb=function(){function e(e){"0"===e.resultCode&&(e=e.data,page.initTemplate(e,"crumb","tempCurmb"))}function o(){$("#marquee").marquee({yScroll:"bottom"})}return page.getData("/message/getScrollMessage",{clientType:"PC"},[e,o])},page.initProp=function(e){function o(e){"0"==e.resultCode&&(e=e.data,page.setTitle(e.pcProductDetail.productTag),"1008013"==e.pcProductDetail.secondCategoryId||"1006001"==e.pcProductDetail.secondCategoryId?($(".JS-banner").hide(),$(".JS-common,.JS-shopStages,.JS-cashStages").hide(),$(".JS-supply").show()):"1008014"==e.pcProductDetail.secondCategoryId||"1004003"==e.pcProductDetail.secondCategoryId?($(".JS-banner").hide(),$(".JS-common,.JS-supply,.JS-cashStages").hide(),$(".JS-shopStages").show()):"1008015"==e.pcProductDetail.secondCategoryId||"1004004"==e.pcProductDetail.secondCategoryId?($(".JS-banner").hide(),$(".JS-common,.JS-supply,.JS-shopStages").hide(),$(".JS-cashStages").show()):"1008016"==e.pcProductDetail.secondCategoryId?console.log("债券转让"):($(".JS-shopStages,.JS-supply,.JS-cashStages").hide(),$(".JS-common").show()))}function n(e){page.isSuccess(e)&&(e=e.data.pcProductDetail,page.set("productRemainAmount",e.productRemainAmount),page.set("staInvestAmount",e.staInvestAmount),page.set("staRateDate",e.staRateDate),page.set("endDate",e.endDate),page.set("annualIncomeText",e.annualIncomeText),page.set("annualIncome",e.annualIncome),page.set("convertDay",e.convertDay),page.set("singleLimitAmount",e.singleLimitAmount),page.set("useCouponTag",e.useCouponTag),page.set("useBirdCoinTag",e.useBirdCoinTag),postData.productId=c,postData.productName=e.productName,postData.convertDay=e.convertDay,postData.staRateDate=e.staRateDate,postData.endDate=e.endDate,postData.annualIncomeText=e.annualIncomeText,postData.annualIncomeText=parseFloat(e.annualIncomeText))}function a(e){"0"==e.resultCode&&(e=e.data,0==e.pcProductDetail.floatTag?$("#floatproject").hide():($("#floatproject").show(),$("#valueOne").html(e.pcProductDetail.bidPublishDate),$("#valueTwo").html(e.pcProductDetail.staRateDate),$("#valueThr").html(e.pcProductDetail.endDate),$("#valueFour").html(e.pcProductDetail.auctionDate),$("#timeValueOne").html(e.pcProductDetail.staRateDate),$("#timeValueTwo").html(e.pcProductDetail.auctionDate)))}function t(e){page.isSuccess(e)&&(e=e.data,page.initTemplate(e.pcProductDetail,"prop","tempProp"))}function i(e){if(page.isSuccess(e)){e=e.data.pcProductDetail;var o=$("#chartProcess")[0],n=echarts.init(o);n.setOption({series:{name:"项目进度",type:"pie",radius:["80%","100%"],label:{normal:{show:!1}},data:[{value:parseInt(e.progress),name:"已完成",itemStyle:{normal:{color:"#ff6f20"}}},{value:100-parseInt(e.progress),name:"剩余",itemStyle:{normal:{color:"#e2e2e2"}}}]}})}}function s(e){function o(){user().loginOperate(a())}function n(){page.when(page.initUser,[page.initShourtcuts,page.initBuy]);var e=$(".common-cover"),o=$("#buy");e.addClass("show"),o.addClass("show")}function a(){return function(){"1"==userType?"-1"==userStatus?window.location.href="/html/user/corporate_fail/":"0"==userStatus?window.location.href="/html/user/corporate_success/":"2"==userStatus?window.location.href="/html/user/corporate_realname1/":"1"==userStatus&&user().nameAuthOperate(n):user().nameAuthOperate(n)}}if($("#invest").on("click",o),"10000006"===e.resultCode)return session().clear(),void user().loginOperate()}var c=page.get("productId");return page.getData("/product/productDetail",{id:c},[n,t,i,s,a,o])},page.initLunbo=function(e){page.initTemplate(e,"propLunbo","tempLunbo");new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",autoHeight:!0})},page.getLCT=function(e){function o(e){"0"===e.resultCode&&(e=e.data,page.initTemplate(e.pcProductIntroduceS,"detail","tempDetail"))}function n(e){var o=e.data.pcProductIntroduceS.infoAuthList;if(""==!o)for(var n=0;n<o.length;n++)"RC"==o[n].infoType&&("房屋买卖合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType1.push(o[n].infoUrl):"房产证"==o[n].infoName&&""!==o[n].infoUrl?page.riskType2.push(o[n].infoUrl):"银行批贷函"==o[n].infoName&&""!==o[n].infoUrl?page.riskType3.push(o[n].infoUrl):"乐巢贷服务合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType4.push(o[n].infoUrl):"个人征信报告"==o[n].infoName&&""!==o[n].infoUrl?page.riskType5.push(o[n].infoUrl):"身份证"==o[n].infoName&&""!==o[n].infoUrl?page.riskType6.push(o[n].infoUrl):"户口本"==o[n].infoName&&""!==o[n].infoUrl?page.riskType7.push(o[n].infoUrl):"个人征信报告"==o[n].infoName&&""!==o[n].infoUrl?page.riskType5.push(o[n].infoUrl):"房产证"==o[n].infoName&&""!==o[n].infoUrl?page.riskType2.push(o[n].infoUrl&&""!==o[n].infoUrl):"产权调查报告"==o[n].infoName&&""!==o[n].infoUrl?page.riskType8.push(o[n].infoUrl):"巢值贷服务合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType9.push(o[n].infoUrl):"工资收入证明"==o[n].infoName&&""!==o[n].infoUrl?page.riskType11.push(o[n].infoUrl):"社保公积金证明"==o[n].infoName&&""!==o[n].infoUrl?page.riskType12.push(o[n].infoUrl):"产权房屋证明"==o[n].infoName&&""!==o[n].infoUrl?page.riskType13.push(o[n].infoUrl):"安翼贷服务合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType14.push(o[n].infoUrl):"车位买卖合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType10.push(o[n].infoUrl):"房屋装修合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType15.push(o[n].infoUrl):"靓巢贷服务合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType16.push(o[n].infoUrl):"展翼贷-001服务合同"==o[n].infoName&&""!==o[n].infoUrl?page.riskType17.push(o[n].infoUrl):"易巢贷服务合同"==o[n].infoName&&""!==o[n].infoUrl&&page.riskType18.push(o[n].infoUrl));var a=e.data.pcProductIntroduceS.borrowUse;"乐巢贷"==a?$("#lechaodai").show():"易巢贷"==a?$("#yichaodai").show():"安翼贷"==a?$("#anyidai").show():"巢值贷"==a?$("#chaozhidai").show():"靓巢贷"==a?$("#liangchaodai").show():"展翼贷001"==a&&$("#zhanyidai").show()}function a(e){""==page.riskType1?$("#item1").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item1").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType1)}),""==page.riskType2?$("#item2").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item2").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType2)}),""==page.riskType3?$("#item3").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item3").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType3)}),""==page.riskType4?$("#item4").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item4").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType4)}),""==page.riskType5?$("#item5").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item5").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType5)}),""==page.riskType1?$("#yichao_item1").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#yichao_item1").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType1)}),""==page.riskType2?$("#yichao_item2").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#yichao_item2").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType2)}),""==page.riskType3?$("#yichao_item3").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#yichao_item3").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType3)}),""==page.riskType18?$("#yichao_item4").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#yichao_item4").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType18)}),""==page.riskType5?$("#yichao_item5").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#yichao_item5").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType5)}),""==page.riskType6?$("#item6").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item6").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType6)}),""==page.riskType7?$("#item7").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item7").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType7)}),""==page.riskType5?$("#item8").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item8").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType5)}),""==page.riskType2?$("#item9").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item9").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType2)}),""==page.riskType8?$("#item10").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item10").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType2)}),""==page.riskType9?$("#item11").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#item11").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType9)}),""==page.riskType6?$("#riskLC1").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC1").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType6)}),""==page.riskType7?$("#riskLC2").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC2").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType7)}),""==page.riskType5?$("#riskLC3").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC3").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType5)}),""==page.riskType15?$("#riskLC4").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC4").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType15)}),""==page.riskType11?$("#riskLC5").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC5").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType11)}),""==page.riskType12?$("#riskLC6").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC6").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType12)}),""==page.riskType16?$("#riskLC7").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskLC7").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType16)}),""==page.riskType6?$("#riskAnyi1").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi1").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType6)}),""==page.riskType7?$("#riskAnyi2").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi2").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType7)}),""==page.riskType5?$("#riskAnyi3").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi3").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType5)}),""==page.riskType10?$("#riskAnyi4").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi4").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType10)}),""==page.riskType10?$("#riskAnyi4").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi4").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType10)}),""==page.riskType11?$("#riskAnyi5").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi5").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType11)}),""==page.riskType12?$("#riskAnyi6").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi6").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType12)}),""==page.riskType13?$("#riskAnyi7").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi7").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType13)}),""==page.riskType14?$("#riskAnyi8").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#riskAnyi8").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType14)}),""==page.riskType6?$("#zhanyidai1").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai1").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType6)}),""==page.riskType7?$("#zhanyidai2").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai2").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType7)}),""==page.riskType5?$("#zhanyidai3").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai3").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType5)}),""==page.riskType4?$("#zhanyidai4").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai4").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType4)}),""==page.riskType11?$("#zhanyidai5").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai5").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType11)}),""==page.riskType12?$("#zhanyidai6").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai6").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType12)}),""==page.riskType17?$("#zhanyidai7").on("click",function(){$("#tankuangLCT").show(),$("#fuceng").show()}):$("#zhanyidai7").on("click",function(){$("#fuceng").show(),$("#propLunbo").show(),$("#close").show(),page.initLunbo(page.riskType17)}),$("#close").on("click",function(){$("#propLunbo").hide(),$("#fuceng").hide(),$("#close").hide()}),$("#close2").on("click",function(){$("#fuceng").hide(),$("#tankuangLCT").hide(),$("#tankuangLCT2").hide()}),$("#close3").on("click",function(){$("#fuceng").hide(),$("#tankuangLCT").hide(),$("#tankuangLCT2").hide()}),$(".tkbut").on("click",function(){$("#fuceng").hide(),$("#tankuangLCT").hide(),$("#tankuangLCT2").hide()})}var t=page.get("productId");return page.getData("/product/productIntroduceS",{clientType:"PC",id:t},[o,n,a])},page.pagDesc=function(){function e(e){page.getDesc(e)}$(".pages").paging({totalSize:page.get("totalCount"),turnSize:5,pageSize:10,currPage:page.get("currPage"),callback:e})},page.getDesc=function(e){function o(e){"0"===e.resultCode&&(e=e.data,page.initTemplate(e,"log","tempLog"))}function n(e){"0"===e.resultCode&&(e=e.data,page.set("totalCount",e.totalCount)),page.pagDesc()}function a(){var e=$("#descTab"),o=$("#descTab .item"),n=[],a=$("#contentTab");o.each(function(e,o){n.push($(o).data("content"))}),n=n.join(" "),e.on("click",function(e){var t=$(e.target);t.hasClass("item")&&(o.removeClass("selected"),t.addClass("selected"),a.removeClass(n).addClass(t.data("content")))}),$(".action").mouseover(function(){$(this).find(".blueIcon").show(),$(this).find(".tankuang").show()}),$(".action").mouseout(function(){$(this).find(".blueIcon").hide(),$(this).find(".tankuang").hide()})}if(page.set("currPage",e),user().isLogin())return $("#logCont").css("display","block"),$(".nolist").css("display","none"),$(".accountpage").css("display","block"),page.getData("/product/purchasehistory",{clientType:"PC",currentPage:e||0,pageSize:10,productId:page.get("productId")},[o,n,a]);$("#logCont").css("display","none"),$(".nolist").css("display","block"),$(".accountpage").css("display","none");var t=$("#descTab"),i=$("#descTab .item"),s=[],c=$("#contentTab");i.each(function(e,o){s.push($(o).data("content"))}),s=s.join(" "),t.on("click",function(e){var o=$(e.target);o.hasClass("item")&&(i.removeClass("selected"),o.addClass("selected"),c.removeClass(s).addClass(o.data("content")))}),$(".action").mouseover(function(){$(this).find(".blueIcon").show(),$(this).find(".tankuang").show()}),$(".action").mouseout(function(){$(this).find(".blueIcon").hide(),$(this).find(".tankuang").hide()}),$("#login2").on("click",function(){user().loginOperate()})},page.initBuy=function(){function e(e){e={},e.productRemainAmount=page.get("productRemainAmount"),e.usableBalance=page.get("usableBalance"),e.coupons=page.get("coupons"),e.staRateDate=page.get("staRateDate"),e.endDate=page.get("endDate"),e.annualIncomeText=page.get("annualIncomeText"),e.useCouponTag=page.get("useCouponTag"),e.useBirdCoinTag=page.get("useBirdCoinTag"),postData.productRemainAmount=e.productRemainAmount,postData.usableBalance=e.usableBalance,postData.annualIncomeText=e.annualIncomeText,postData.useBirdCoinTag=e.useCouponTag,postData.useBirdCoinTag=e.useBirdCoinTag,page.initTemplate(e,"buy","tempBuy"),page.operateEndMoney()}function o(){function e(){var e=$(".common-cover"),o=$("#buy");e.removeClass("show"),o.removeClass("show")}function o(e){var o=+page.get("coin"),n=+$("#amount").val()||0,a=parseInt(n/6*100)/100,t=$("[for=isCoin]"),i=Math.min(o,a);return e||(i=0),t.text(i+"鸟币抵扣"+Util.padFloatMoney(i)+"元"),$("#actual").text(Util.padFloatMoney(n-i)+"元"),page.set("buyAmount",n),i}$("#buyClose").on("click",e),$("#amount[readonly!='readonly']").on("blur",function(e){page.validate($(this))}),$("#isCoin").on("click",function(e){var n=$(this).prop("checked");postData.usedCoin=o(n)}),$("#btnBuy").on("click",function(e){if(page.isEnd||page.validate($("#amount")),0!=$("#form").find(".validate-failed").length)return!1;var o="请选择..."==$("#coupons").val()?"0":$("#coupons").val(),n=$("#coupons").find("option:selected").text().trim(),a=$("#yuqiAmount").data("code")||"",t=$("#yuqiAmount").data("amount");postData.isNoPwdTZ=page.get("isNoPwdTZ"),postData.usedCoupon=o,postData.usedCouponText=n,$("#code").hasClass("pitch")?(postData.presentCode=a,postData.usedCouponText=t,postData.usedCoupon=""):(postData.usedCoupon=o,postData.presentCode="",postData.usedCouponText=n),page.post("./confirm",postData)})}function n(){$(".radio").on("click",function(){var e=$(this).parent().attr("class");$("#coupons").find("option:first").attr("selected",!0).siblings().attr("selected",!1),$("#presentCode").val(""),$("#code").attr("class","code"),$("#yuqiAmount").html(""),"tickits"==e?($("#coupons").addClass("pitch"),$("#code").removeClass("pitch")):($("#code").addClass("pitch"),$("#coupons").removeClass("pitch"),$("#code #presentCode").on("blur",function(){page.getCode()}))})}e(),o(),n()},page.operateEndMoney=function(){page.isEnd=!0,postData.usedCoin=0;var e=$("#amount"),o=e.parent().parent(),n=o.find(".validation"),a=parseFloat(page.get("staInvestAmount")),t=parseFloat(page.get("productRemainAmount"));parseFloat(page.get("singleLimitAmount"));t<=a&&(e.attr("readonly","readonly"),e.val(t),o.addClass("validate-success").removeClass("validate-failed"),n.html("最后一笔投资只能为剩余金额"),$("#actual").html(t+"元"),postData.buyAmount=t)},page.validate=function(_this){function roundNum(number,fDigits){with(Math)return round(number*pow(10,fDigits))/pow(10,fDigits)}function mutilRealAmount(e){var o=genCoin($("#isCoin").prop("checked"));$row.removeClass("validate-failed").addClass("validate-success"),$("#amount-validate").text(""),$("#actual").text(Util.padFloatMoney(e-o)+"元"),page.set("buyAmount",e),postData.buyAmount=parseFloat(e),postData.usedCoin=o,validated=!0,genCoin(o),initCoupons()}function initCoupons(){for(var e,o=+$("#amount").val()||0,n=filterCoupons(o),a=$("#coupons"),t=[$("<option>").text("请选择...")],i=0,s=n.length;i<s;i++)e=n[i],e.limit<=o&&(t.push($("<option data-type="+e.type+" data-amount="+e.amount+">").attr("value",e.id).text(e.name)),a.empty().append(t));0==s&&(t.shift(),t.push($("<option>").attr("value","").text("暂无可用券...")),a.empty().append(t)),a.unbind("change").bind("change",function(){var e=$("#coupons").find("option:selected").data(),o=$("#coupons").find("option:selected").html();isEmptyObject(e)?$("#yuqiAmount").html(""):$("#yuqiAmount").html("+"+o)})}function genCoin(e){var o=+page.get("coin"),n=+$("#amount").val()||0,a=parseInt(n/6*100)/100,t=$("[for=isCoin]"),i=Math.min(o,a);return e||(i=0),t.text(i+"鸟币抵扣"+Util.padFloatMoney(i)+"元"),$("#actual").text(Util.padFloatMoney(n-i)+"元"),page.set("buyAmount",n),i}function filterCoupons(e){for(var o,n=[],a=page.get("coupons"),t=0;t<a.length;t++)o=a[t],e>=o.limit&&n.push(o);return n}var money=+_this.val(),$row=_this.parents(".row").eq(0),start=+page.get("staInvestAmount"),userRest=+page.get("usableBalance"),prodRest=+page.get("productRemainAmount"),danbirest=+page.get("singleLimitAmount"),validated=!1;if(isNaN(money))$row.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("请输入正确金额");else if(money>userRest)$row.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("个人账户余额不足，请").append($("<a>").attr({href:"/html/account/bank",target:"_blank"}).addClass("link").text("充值")),$(".link").on("click",function(){window.location.reload()});else if(money<start)$row.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("最低投资金额为"+Util.padFloatMoney(start)+"元");else if(money>prodRest)$row.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("产品剩余可投金额不足");else if(danbirest>0&&money>danbirest)$row.removeClass("validate-success").addClass("validate-failed"),$("#amount-validate").text("输入的金额超过了单笔投资上限");else{mutilRealAmount(money);var profit=roundNum(mutilPreProfit(money,page.get("annualIncome"),page.get("convertDay")),2);page.set("profit",profit);var opeitonEd=$("#coupons").find("option:selected").data();opeitonEd&&(profit=moreProfit(profit,opeitonEd)),$(".preprofit").text(profit)}},page.getCode=function(){function e(e){if("0"===e.resultCode){var e=e.data;$("#yuqiAmount").attr("data-code",o),$("#yuqiAmount").attr("data-amount",e.coupon.couponName),$("#yuqiAmount").html("+"+e.coupon.couponName),$("#code").addClass("vaid-success").removeClass("valid-fail")}else $("#code").addClass("valid-fail").removeClass("vaid-success"),$("#code .valid .validTips").html(e.resultMessage)}var o=$("#presentCode").val();return page.getData("/pc/account/fxq/couponInfo/get",{presentCode:o},[e])},page.init=function(){page.setTitle("乐巢投"),page.set("productId",Url.getHashParts(0)),page.initCrumb(),page.when(page.initProp,[page.getLCT]),page.getDesc()},page.init()});