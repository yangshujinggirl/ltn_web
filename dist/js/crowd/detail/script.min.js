!function(){function t(t){var e=t.productType;"A"===e&&($(".tab_content").find(".left-content").addClass("tab_left"),$(".tab_content").find(".right-content").removeClass("disabled"),$(".risk").find(".risk_item").removeClass("item1").addClass("item2"),$("#imgPice").attr("src","/img/imageTwo/mutual/details_img3.png"))}function e(){$(".JS-buy-btn").bind("click",function(){return!$(this).hasClass("disabled")&&(P.amount=$(this).attr("data-amount")||0,P.stepId=$(this).attr("data-stepId")||0,k.isLogin()?l(function(t,e){var u={userInfo:t,prodetail:e,page:P};P.userInfo=t,"A"==P.prodetail.productType?P.initTemplate(u,"BuyDialog","TemplateBuyDialogA"):P.initTemplate(u,"BuyDialog","TemplateBuyDialog"),m(function(){h(),n(),i(),a(),o(),d(),r()})}):k.loginOperate(),void 0)})}function o(){$("#btnBuy").bind("click",function(){if(P.amount&&0!=P.amount){var t={birdCoin:P.birdCoin,orderAmount:P.amount,productId:P.prodetail.productId,userCouponId:P.userCouponId||0,couponName:P.couponName,productName:P.prodetail.productName,productType:P.prodetail.productType,presentCode:P.presentCode};"A"===P.prodetail.productType&&(t.stepId=P.stepId),sessionStorage.removeItem("orderForm");var e=encodeURIComponent(JSON.stringify(t));sessionStorage.setItem("orderForm",e),"A"==P.prodetail.productType?window.location.href="/html/crowd/detail/confirm/":window.location.href="/html/crowd/detail/confirmb/"}else{var o=$(".product-buy").find(".input-amount");u(o)}})}function n(){var t=$(".product-buy").find(".input-amount");t.unbind("blur"),"undefined"==typeof P.amount||0==P.amount?(t.removeAttr("readonly"),t.bind("blur",function(){P.amount=$(this).val(),$('label[for="isCoin"]').text("0鸟币抵扣0.00元"),u(t)?s():$("#actual").text("0.00元")})):(t.attr("readonly","true"),t.val(P.amount),u(t)&&s())}function a(t){$("#sureBtn").bind("click",function(){var t=$("#presentCode").val();P.getData("/pc/account/fxq/couponInfo/get",{presentCode:t},function(t){$("#code").removeClass("valid-fail"),"0"!=t.resultCode?($("#code").addClass("valid-fail"),$("#code").find(".valid").show(),$("#code").find(".validTips").text(t.resultMessage),P.userCouponId=0):($("#presentCode").val(t.data.coupon.couponName),P.userCouponId=t.data.coupon.userCouponId,P.couponName=t.data.coupon.couponName)})})}function i(){$("#tickits,#convertTickits").bind("click",function(){return!$(this).hasClass("selected")&&($("#tickits,#convertTickits").removeClass("selected"),$(this).hasClass("selected"),"tickits"==$(this).attr("id")?($("#coupons").show(),$("#code").hide()):($("#coupons").hide(),$("#code").show()),void 0)})}function d(){$("#coupons").change(function(){P.userCouponId=$(this).val(),P.couponName=$(this).find(":selected").text()})}function r(){$("#presentCode").change(function(){P.presentCode=$(this).val()})}function u(t){return!P.amount||P.amount<P.minAmount?(t.parents(".row").addClass("validate-failed"),$("#amount-validate").show().text("不能小于起投金额"),P.amount=0,!1):!P.amount||P.amount>P.maxAmout?(t.parents(".row").addClass("validate-failed"),$("#amount-validate").show().text("投资金额不能大于剩余金额"),P.amount=0,!1):P.amount>P.userInfo.usableBalance?(t.parents(".row").addClass("validate-failed"),$("#amount-validate").show().html('个人账户余额不足，请<a href="/html/account/bank/" >充值</a>'),P.amount=0,!1):(t.parents(".row").removeClass("validate-failed"),$("#amount-validate").hide(),!0)}function s(){P.getData("/orderZc/orderZcPrepare",{orderAmount:P.amount,productId:P.prodetail.productId,stepId:P.stepId},function(t){var e=t.data;P.birdCoin=e.birdCoin,"1"==P.prodetail.useCouponTag&&(P.initTemplate(e.coupons,"coupons","TemplateCouponsList"),$('label[for="isCoin"]').text(e.birdCoin+"鸟币抵扣"+e.birdCoin+"元")),"1"==P.prodetail.useBridcoinTag&&$('label[for="isCoin"]').text(e.birdCoin+"鸟币抵扣"+e.birdCoin+"元"),$("#actual").text(P.amount-P.birdCoin+"元");var o=$("#isCoin");o.unbind("click"),o.bind("click",function(){c()})})}function c(){var t=$("#isCoin").is(":checked");t?$("#actual").html(P.amount-P.birdCoin+"元"):$("#actual").html(P.amount+"元")}function l(t){P.getData("/user/userInfo",{},function(e){P.isSuccess(e)?"function"==typeof t&&t.call(this,e.data,P.prodetail):(alert("登录超时，请重新登录"),k.loginOperate())})}function p(t){var e=t.productSoldedAmount,o=t.productTotalAmount,n=e/o*100,a=n+"%";$(".bar").find(".completed").css({width:a})}function m(t){$(".common-cover").show(),$(".product-buy").show(),"function"==typeof t&&t.call()}function f(){$(".common-cover").hide(),$(".product-buy").hide()}function h(){$("#buyClose").unbind("click"),$("#buyClose").bind("click",function(){f()})}function g(t){"A"===t.productType&&b(t)?$(".JS-buy-btn").hasClass("disabled")||$(".JS-buy-btn").removeClass("disabled"):b(t)&&C(t)?$(".JS-buy-btn").removeClass("disabled"):$(".JS-buy-btn").addClass("disabled")}function b(t){return"1"===t.productStatus}function C(t){return t.productSoldedAmount<t.productTotalAmount}function v(t){var t=t.substring(1),e=null;return t.length&&(e=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')),e}function T(){$(".details_tab .tab_title li").bind("click",function(){if($(this).hasClass("selected"))return!1;$(this).addClass("selected").siblings("li").removeClass("selected");var t=$(this).attr("data-contentClass");y($("."+t))}),$(".details_tab .tab_title li").eq(0).trigger("click")}function y(t){t.hasClass("record-list")?I(P.prodetail.productId,0,function(){t.show().siblings("li").hide()}):t.show().siblings("li").hide()}function I(t,e,o){P.getData("/orderZc/searchOrderZc",{productId:t,currentPage:e||0,pageSize:10},function(t){var e=t.data.orderZcList;P.initTemplate(e,"proRecordList","TemplateProRecordList"),P.initPagination||A(P,t.data.totalCount,10),o&&o.call()})}function A(t,e,o){$("#light-pagination").pagination({items:e||0,itemsOnPage:o||10,prevText:"<<",nextText:">>",cssStyle:"light-theme",onInit:function(){t.initPagination=!0},onPageClick:function(e,o){I(t.prodetail.productId,e-1)}})}var w=v(location.search),x=w.productId,S="/productZc/productZcDetail",k=new user,P=new Page;P.amount=0,P.getData(S,{productId:x},function(o){var n=o.data;P.prodetail=n,P.maxAmout=n.productTotalAmount-n.productSoldedAmount,n.staInvestAmount>P.maxAmout?P.minAmount=P.maxAmout:P.minAmount=n.staInvestAmount,"A"==n.productType?(P.initTemplate(n,"prodetaiSumWrap","TemplateAProdetailSum"),P.initTemplate(n.stepList,"setpList","TemplateSetpList"),P.initTemplate(n,"propTabxiangqiang","TemplatePropA")):(P.initTemplate(n,"prodetaiSumWrap","TemplateProdetailSum"),P.initTemplate(n,"propTabxiangqiang","TemplatePropB")),e(),g(n),T(),p(n),t(n)}),Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in e)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[o]:("00"+e[o]).substr((""+e[o]).length)));return t}}();