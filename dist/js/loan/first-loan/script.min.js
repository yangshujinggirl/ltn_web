!function(){var e=new Page;e.setTitle("筑巢贷");var t={dist:location.href.substr(0,location.href.indexOf("/",7)),isLogin:function(){return"undefined"!=typeof user&&user().isLogin()},Login:function(e){e=e||location.href,location.href="/html/user/login/?url="+encodeURIComponent(e)},RealName:function(e){e=e||location.href,location.href="/html/loan/realnameloan/?url="+encodeURIComponent(e)},getRealName:function(e){return $.post(constant().url+"/account/center/nameAuthInfo",{clientType:constant().clientType,sessionKey:constant().sessionKey})},testValida:function(e){var n=t.isLogin();n?t.getRealName().done(function(t,n){"success"==n&&"0"==t.resultCode?e&&e(t.data):alert(user().testResultCode(t.resultCode))}).fail(function(){alert("获取实名认证请求失败")}):t.Login()},getLoan:function(e){var t=constant().url+"/user/loanInfo/query";$.get(t,{clientType:constant().clientType,loanType:"6",sessionKey:constant().sessionKey},function(t,n){"success"==n&&"0"==t.resultCode?t.data.loanQueryEntry.followTag!=-1&&"41"!=t.data.loanQueryEntry.followTag&&"1"==t.data.loanQueryEntry.isSuccess?location.href="/html/loan/plans/?type=6":e&&e():alert(user().testResultCode(t.resultCode))})}},n={start:function(){var e=(t.isLogin(),this),n={city:["上海市","杭州市","宁波市"],money:["10万以内","10-30万","30-60万","60-80万","80-100万"]},a=1;t.testValida(function(a){1==a.certification?t.getLoan(function(){e.renderProcess({userName:a.userName,cardId:a.cardId,phone:session().get("login"),selects:n,type:"zhuchao"}),e.applyClick()}):t.RealName()}),e.renderCounter({type:"other",limit:[{name:"6个月",value:6},{name:"12个月",value:12},{name:"36个月",value:36},{name:"60个月",value:60}],huan:[{name:"等额本金",value:1},{name:"等额本息",value:2}]}),$("#htmLoanCounter button.apply").on("click",function(){if(a){a=0;var t,n=Number(e.getValue("applymoney","input")),o=Number(e.getValue("limit","select")),l=Number(e.getValue("loanrate","input"))/100,u=Number(e.getValue("type","select")),r=$("#tmpLoanResult").html(),s={type:"other",applyMoney:n,surPlusMoney:[],limit:o,rate:l,perRate:[],perMoney:[],allMoney:0,allRate:0};if(1==u){for(var i=0;i<o;i++){var c=Number(n/o);s.perMoney.push(c);var p=Number(n-c*(i+1)),m=Number((n-c*i)*(l/12));s.perRate.push(m),s.surPlusMoney.push(p),s.allRate+=m}s.allMoney=s.allRate+n}else{for(var p=100,i=0;i<o;i++){var f=l/12,y=n*f*Math.pow(1+f,o),d=Math.pow(1+f,o)-1,h=Number(y/d),m=Number((n*f-h)*Math.pow(1+f,i)+h);s.perRate.push(m);var c=Number(h-m);s.perMoney.push(c),p-=c,s.surPlusMoney.push(p),s.allRate+=m}s.allMoney=s.allRate+n}t=$(doT.template(r)(s)),t.appendTo(document.body).hide().fadeIn(300),t.find("button.close").click(function(){a=1,t.remove()}),setTimeout(function(){t.css({marginTop:-t.outerHeight()/2})},70)}})},renderProcess:function(e){template().renduTemplate("tmpLoanProcess","htmLoanProcess",e)},renderCounter:function(e){template().renduTemplate("tmpLoanCounter","htmLoanCounter",e)},applyClick:function(){var e=this;$("#htmLoanProcess button.apply").on("click",function(){return user().testSubmit(),0==$(".form").find(".validate-failed").length&&void e.submit()})},getValue:function(e,t){var n,a,o=document.getElementsByName(e);switch(t){case"input":var l=o[0];"undefined"!=typeof l&&(n=l.value);break;case"select":var l=o[0];"undefined"!=typeof l&&(a=l.selectedIndex,n=l.options[a].value);break;case"radio":for(a=0;a<o.length;a++)if(o[a].checked){n=o[a].value;break}break;case"checkbox":for(a=0,n=[];a<o.length;a++)o[a].checked&&n.push(o[a].value)}return n},submit:function(){var e=constant().url+"/user/loanInfo/submit",t=this;$.post(e,{cityName:t.getValue("city","select"),loanAmount:t.getValue("loanmoney","select"),paymentPercent:t.getValue("firstpay","select"),propertyLocation:t.getValue("position","select"),name:t.getValue("username","input"),mobileNo:t.getValue("phone","input"),idCard:t.getValue("IDCard","input"),housePrice:t.getValue("price","input"),houseCover:t.getValue("areas","input"),email:t.getValue("email","input"),sex:t.getValue("sex","radio"),comuntiyName:t.getValue("areaname","input"),decorateCompany:t.getValue("fitment","input"),clientType:constant().clientType,sessionKey:constant().sessionKey,loanType:6},function(e,t){"success"==t&&"0"==e.resultCode?location.href="/html/loan/plans/?type=6":alert(user().testResultCode(e.resultCode))})}};n.start()}();