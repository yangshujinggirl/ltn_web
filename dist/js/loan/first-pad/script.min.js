!function(){var e={dist:location.href.substr(0,location.href.indexOf("/",7)),isLogin:function(){return"undefined"!=typeof user&&user().isLogin()},Login:function(e){e=e||location.href,location.href=this.dist+"/html/user/login/?url="+encodeURIComponent(e)},RealName:function(e){e=e||location.href,location.href=this.dist+"/html/loan/realnameloan/?url="+encodeURIComponent(e)},getRealName:function(e){return $.post(constant().url+"/account/center/nameAuthInfo",{clientType:constant().clientType,sessionKey:constant().sessionKey})},testValida:function(t){var n=e.isLogin();n?e.getRealName().done(function(e,n){"success"==n&&"0"==e.resultCode?t&&t(e.data):alert(user().testResultCode(e.resultCode))}).fail(function(){alert("获取实名认证请求失败")}):e.Login()},getLoan:function(e){var t=constant().url+"/user/loanInfo/query",n=this;$.get(t,{clientType:constant().clientType,sessionKey:constant().sessionKey},function(t,o){"success"==o&&"0"==t.resultCode?t.data.loanQueryEntry.followTag!=-1?location.href=n.dist+"/html/loan/plans/":e&&e():alert(user().testResultCode(t.resultCode))})}},t={start:function(){var t=(e.isLogin(),this),n={city:["上海市","杭州市","宁波市"],money:["100万以内","100-200万","200-300万","300-400万","400-500万"]},o=1;e.testValida(function(o){1==o.certification?e.getLoan(function(){t.renderProcess({userName:o.userName,cardId:o.cardId,phone:session().get("login"),selects:n}),t.applyClick("#htmLoanProcess button.apply")}):e.RealName()}),t.renderCounter({first:!1,limit:[],type:[{name:"一次性还本付息",value:3}]}),$("#htmLoanCounter button.apply").on("click",function(){if(o){o=0;var e=Number(t.getValue("applymoney","input")),n=Number(t.getValue("serverate","input")),a=$("#tmpLoanResult").html(),s={first:!1,applyMoney:e,allMoney:e*(1+n/100),rateMoney:e*n/100},i=doT.template(a)(s);i=$(i),i.appendTo(document.body),i.find("button.close").click(function(){o=1,i.remove()})}})},renderProcess:function(e){template().renduTemplate("tmpLoanProcess","htmLoanProcess",e)},renderCounter:function(e){template().renduTemplate("tmpLoanCounter","htmLoanCounter",e)},applyClick:function(e){var t=this;$(e).on("click",function(){return user().testSubmit(),0==$(".form").find(".validate-failed").length&&void t.submit()})},getValue:function(e,t){var n,o,a=document.getElementsByName(e);switch(t){case"input":var s=a[0];"undefined"!=typeof s&&(n=s.value);break;case"select":var s=a[0];"undefined"!=typeof s&&(o=s.selectedIndex,n=s.options[o].value);break;case"radio":for(o=0;o<a.length;o++)if(a[o].checked){n=a[o].value;break}break;case"checkbox":for(o=0,n=[];o<a.length;o++)a[o].checked&&n.push(a[o].value)}return n},submit:function(){var t=constant().url+"/user/loanInfo/submit",n=this;$.post(t,{cityName:n.getValue("city","select"),loanAmount:n.getValue("loanmoney","select"),paymentPercent:n.getValue("firstpay","select"),propertyLocation:n.getValue("position","select"),name:n.getValue("username","input"),mobileNo:n.getValue("phone","input"),idCard:n.getValue("IDCard","input"),housePrice:n.getValue("price","input"),houseCover:n.getValue("areas","input"),sex:n.getValue("sex","radio"),clientType:constant().clientType,sessionKey:constant().sessionKey,loanType:2},function(t,n){"success"==n&&"0"==t.resultCode?location.href=e.dist+"/html/loan/plans/":alert(user().testResultCode(t.resultCode))})}};t.start()}();