!function(){var e=new Page;e.setTitle("乐巢贷");var t={dist:location.href.substr(0,location.href.indexOf("/",7)),isLogin:function(){return"undefined"!=typeof user&&user().isLogin()},Login:function(e){e=e||location.href,location.href="/html/user/login/?url="+encodeURIComponent(e)},RealName:function(e){e=e||location.href,location.href="/html/user/realname/?url="+encodeURIComponent(e)},getRealName:function(e){return $.post(constant().url+"/account/center/nameAuthInfo",{clientType:constant().clientType,sessionKey:constant().sessionKey})},testValida:function(e){var n=t.isLogin();n?t.getRealName().done(function(t,n){"success"==n&&"0"==t.resultCode?e&&e(t.data):alert(user().testResultCode(t.resultCode))}).fail(function(){alert("获取实名认证请求失败")}):t.Login()},getLoan:function(e){var t=constant().url+"/user/loanInfo/query",n=this;$.get(t,{clientType:constant().clientType,loanType:"2",sessionKey:constant().sessionKey},function(t,o){"success"==o&&"0"==t.resultCode?t.data.loanQueryEntry.followTag!=-1&&"41"!=t.data.loanQueryEntry.followTag&&"1"==t.data.loanQueryEntry.isSuccess?location.href=n.dist+"/html/loan/plans2/?type=4":e&&e():alert(user().testResultCode(t.resultCode))})}},n={start:function(){var e=(t.isLogin(),this),n={city:["上海市","杭州市","宁波市"],money:["500万以内","500-800万","800-1100万","1100-1300万","1300-1500万"]},o=1;t.testValida(function(o){1==o.certification?t.getLoan(function(){e.renderProcess({userName:o.userName,cardId:o.cardId,phone:session().get("login"),selects:n,type:"lechao"}),e.applyClick()}):t.RealName()}),e.renderCounter({huan:[{name:"一次性还本付息",value:3}],type:"lechao"}),$("#htmLoanCounter button.apply").on("click",function(){if(o){o=0;var t=Number(e.getValue("applymoney","input")),n=Number(e.getValue("serverrate","input")),a=$("#tmpLoanResult").html(),s={type:"lechao",applyMoney:t,allMoney:t*(1+n/100),rateMoney:(t*n/100).toFixed(2)},l=doT.template(a)(s);l=$(l),l.appendTo(document.body),l.find("button.close").click(function(){o=1,l.remove()})}})},renderProcess:function(e){template().renduTemplate("tmpLoanProcess","htmLoanProcess",e)},renderCounter:function(e){template().renduTemplate("tmpLoanCounter","htmLoanCounter",e)},applyClick:function(e){var t=this;$("#htmLoanProcess button.apply").on("click",function(){return user().testSubmit(),0==$(".form").find(".validate-failed").length&&void t.submit()})},getValue:function(e,t){var n,o,a=document.getElementsByName(e);switch(t){case"input":var s=a[0];"undefined"!=typeof s&&(n=s.value);break;case"select":var s=a[0];"undefined"!=typeof s&&(o=s.selectedIndex,n=s.options[o].value);break;case"radio":for(o=0;o<a.length;o++)if(a[o].checked){n=a[o].value;break}break;case"checkbox":for(o=0,n=[];o<a.length;o++)a[o].checked&&n.push(a[o].value)}return n},submit:function(){var e=constant().url+"/user/loanInfo/submit",t=this;$.post(e,{cityName:t.getValue("city","select"),loanAmount:t.getValue("loanmoney","select"),paymentPercent:t.getValue("firstpay","select"),propertyLocation:t.getValue("position","select"),name:t.getValue("username","input"),mobileNo:t.getValue("phone","input"),idCard:t.getValue("IDCard","input"),housePrice:t.getValue("price","input"),houseCover:t.getValue("areas","input"),email:t.getValue("email","input"),sex:t.getValue("sex","radio"),comuntiyName:t.getValue("areaname","input"),propertyCompany:t.getValue("agent","input"),clientType:constant().clientType,sessionKey:constant().sessionKey,loanType:2},function(e,t){"success"==t&&"0"==e.resultCode?location.href="/html/loan/plans3/?type=2":alert(user().testResultCode(e.resultCode))})}};n.start()}();