$(function(){var e=new Page;dept=session().get("dept"),e.setTitle("注册新用户");var t={guid:"",getImageCode:function(){var e={clientType:constant().clientType,machineNo:guid,dept:dept};$.post(constant().url+"/user/register/pictureCode",e,function(e,a){if("success"==a&&"0"==e.resultCode){var i=constant().url+e.data.pictureCode;template().renduTemplate("templateImageCode","imageCon",i),$("#imageCode").on("click",function(){t.getImageCode()}),$("#imgCode").on("click",function(){t.getImageCode()}),$("input:not(:checkbox,:radio),select,textarea").on("blur",function(){_this=$(this);var e=_this.parent().parent(),a=e.find(".validation"),i="validate-success",s="validate-failed";validate().vd(_this,e,a,i,s,!1),t.addEvent(_this,e,a)}),$("input,select,textarea").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var t=e.find(".validation");t.html(""),$("#loginTip").hide()})}})},addEvent:function(e,a,i){return"txtTel"==e.attr("id")&&!a.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void t.getPhoneIsTrue(e,!1):"txtCode"==e.attr("id")&&!a.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void t.getCodeIsTrue(e):"txtTel2"==e.attr("id")&&!a.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void t.getPhoneIsTrue(e,!0):void 0},getPhoneCode:function(){var e=$("#txtTel").val(),a=$("#txtCode").val(),i={clientType:constant().clientType,machineNo:guid,mobileNo:e,pictureCode:a,sendType:"1",dept:dept};$.post(constant().url+"/mobile/pcmobilecode/getMobileCode",i,function(e,a){if("success"==a)if("0"==e.resultCode){var i=$("#sendPhoneCode");$("#sendPhoneCode").addClass("disabled").attr("disabled","disabled"),t.timing(i,50)}else $("#wrapIdentity").hide(),t.initPhoneCode(),alert(e.resultMessage)})},initPhoneCode:function(){var e=$("#sendPhoneCode");e.html("重新发送").addClass("disabled").attr("disabled","disabled"),t.getImageCode(),$("#wrapImg").removeClass("validate-success")},timing:function(e,a){var i=setInterval(function(){--a,a<0?(clearInterval(i),t.initPhoneCode()):e.html(a+"s")},1e3)},getPhoneIsTrue:function(e,a){var i=strUtil().trim(e.val()),s=e.parent().parent(),d=s.find(".validation"),n={clientType:constant().clientType,mobileNo:i,dept:dept};$.post(constant().url+"/pc/login/validateMobileExist",n,function(e,i){"success"==i&&"0"==e.resultCode&&(a?"1"==e.data.isMobileExist?s.addClass("validate-success").removeClass("validate-failed"):(s.addClass("validate-failed").removeClass("validate-success"),d.html("该用户不存在")):"1"==e.data.isMobileExist?(s.addClass("validate-failed").removeClass("validate-success"),d.html("该用户已注册")):s.addClass("validate-success").removeClass("validate-failed"),t.initSendBtn())})},getCodeIsTrue:function(e){var a=strUtil().trim(e.val()),i=e.parent().parent(),s=i.find(".validation"),d={clientType:constant().clientType,machineNo:guid,pictureCode:a,dept:dept};$.post(constant().url+"/pc/login/validatePicCode",d,function(e,a){"success"==a&&"0"==e.resultCode&&("1"==e.data.isPicCodeRight?i.addClass("validate-success").removeClass("validate-failed"):(i.addClass("validate-failed").removeClass("validate-success"),s.html("请输入正确的图片验证码!"),t.getImageCode()),t.initSendBtn())})},initRegister:function(){t.getImageCode()},testRegister:function(e,a,i,s){var d={clientType:constant().clientType,mobileCode:e,mobileNo:a,partnerMobile:i,password:s,readAndAgree:"1",guestType:"1",dept:dept};$.post(constant().url+"/user/register/registerUser",d,function(e,a){var i=$("#wranTip");if("0"==e.resultCode)location.href="/html/user/corporate_realname1/";else{$("#loginTip").show();var s;s=user().testResultCode(e.resultCode),i.html(s),t.initRegister()}})},getPhoneAndCodeIsTrue:function(){var e=$("#wrapTel"),t=$("#wrapImg");return!(!e.hasClass("validate-success")||!t.hasClass("validate-success"))},initSendBtn:function(){t.getPhoneAndCodeIsTrue()?$("#sendPhoneCode").removeClass("disabled").removeAttr("disabled"):$("#sendPhoneCode").addClass("disabled").attr("disabled","disabled")},dealPhoneCode:function(){var e=$("#sendPhoneCode");e.html("发送中..."),e.attr("disabled","disabled"),t.getPhoneCode()},init:function(){guid=strUtil().getGuid(),t.getImageCode()}};t.init(),$("#submit").not(".disabled").on("click",function(){if(user().testSubmit(t.addEvent),0!=$("#form").find(".validate-failed").length)return!1;var e=strUtil().trim($("#txtPhoneCode").val()),a=strUtil().trim($("#txtTel").val()),i=strUtil().trim($("#txtTel2").val()),s=$("#txtPsd").val();t.testRegister(e,a,i,s)}),$("#tuijian").on("click",function(){$("#invitationpeople").toggle("normal"),$(".tuijian i").hasClass("jiantou")?($(".tuijian i").removeClass("jiantou"),$(".tuijian i").addClass("jiantou2")):($(".tuijian i").addClass("jiantou"),$(".tuijian i").removeClass("jiantou2"))}),$("#isRead").on("change",function(){var e=$(this),t=$("#submit");e.attr("checked")?(e.attr("checked",!1),t.addClass("disabled"),t.attr("disabled","true")):(e.attr("checked","true"),t.removeClass("disabled"),t.removeAttr("disabled"))}),$("#sendPhoneCode").on("click",t.dealPhoneCode)});