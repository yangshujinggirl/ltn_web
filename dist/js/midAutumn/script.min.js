$(function(){var e=new Page;e.setTitle("注册新用户");var t="",a={guid:"",getImageCode:function(){var e,t=a.getSearchParts("dept");e=""!=t||"undefined"!=typeof t?{clientType:constant().clientType,machineNo:guid,dept:a.getSearchParts("dept")}:{clientType:constant().clientType,machineNo:guid},$.post(constant().url+"/user/register/pictureCode",e,function(e,t){if("success"==t&&"0"==e.resultCode){var i=constant().url+e.data.pictureCode;template().renduTemplate("templateImageCode","imageCon",i),$("#imageCode").on("click",function(){a.getImageCode()}),$("input:not(:checkbox,:radio),select,textarea").on("blur",function(){_this=$(this);var e=_this.parent().parent(),t=e.find(".validation"),i="validate-success",s="validate-failed";validate().vd(_this,e,t,i,s,!1),a.addEvent(_this,e,t)}),$("input,select,textarea").on("focus",function(){var e=$(this).parent().parent();e.removeClass(validate().vdFailed);var t=e.find(".validation");t.html(""),$("#loginTip").hide()})}})},getSearchParts:function(e){var t,a=window.location.search,i=a.substr(1).split("&"),s={},d=i.length;for(t=0;t<d;t++){var n=i[t].split("=");s[n[0]]=n[1]}return e?s[e]:s},addEvent:function(e,t,i){return"txtTel"==e.attr("id")&&!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void a.getPhoneIsTrue(e,!1):"txtCode"==e.attr("id")&&!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void a.getCodeIsTrue(e):"txtPsd2"==e.attr("id")&&!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void a.getPsdIsEqual(e.val()):"txtTel2"==e.attr("id")&&!t.hasClass("validate-failed")&&strUtil().trim(e.val()).length>0?void a.getPhoneIsTrue(e,!0):void 0},getPhoneCode:function(){var e,t=$("#txtTel").val(),i=$("#txtCode").val(),s=a.getSearchParts("dept");e=""!=s||"undefined"!=typeof s?{clientType:constant().clientType,machineNo:guid,mobileNo:t,pictureCode:i,sendType:"1",dept:a.getSearchParts("dept")}:{clientType:constant().clientType,machineNo:guid,mobileNo:t,pictureCode:i,sendType:"1"},$.post(constant().url+"/mobile/pcmobilecode/getMobileCode",e,function(e,t){if("success"==t)if("0"==e.resultCode){var i=$("#sendPhoneCode");$("#sendPhoneCode").addClass("disabled").attr("disabled","disabled"),a.timing(i,50)}else $("#wrapIdentity").hide(),a.initPhoneCode(),alert(e.resultMessage)})},initPhoneCode:function(){var e=$("#sendPhoneCode");e.html("重新发送").addClass("disabled").attr("disabled","disabled"),a.getImageCode(),$("#wrapImg").removeClass("validate-success")},timing:function(e,t){var i=setInterval(function(){--t,t<0?(clearInterval(i),a.initPhoneCode()):e.html(t+"s")},1e3)},getPhoneIsTrue:function(e,t){var i,s=strUtil().trim(e.val()),d=e.parent().parent(),n=d.find(".validation"),l=a.getSearchParts("dept");i=""!=l||"undefined"!=typeof l?{clientType:constant().clientType,mobileNo:s,dept:a.getSearchParts("dept")}:{clientType:constant().clientType,mobileNo:s},$.post(constant().url+"/pc/login/validateMobileExist",i,function(e,i){"success"==i&&"0"==e.resultCode&&(t?"1"==e.data.isMobileExist?d.addClass("validate-success").removeClass("validate-failed"):(d.addClass("validate-failed").removeClass("validate-success"),n.html("账号不存在!")):"1"==e.data.isMobileExist?(d.addClass("validate-failed").removeClass("validate-success"),n.html("账号已存在!")):d.addClass("validate-success").removeClass("validate-failed"),a.initSendBtn())})},getCodeIsTrue:function(e){var t,i=strUtil().trim(e.val()),s=e.parent().parent(),d=s.find(".validation"),n=a.getSearchParts("dept");t=""!=n||"undefined"!=typeof n?{clientType:constant().clientType,machineNo:guid,pictureCode:i,dept:a.getSearchParts("dept")}:{clientType:constant().clientType,machineNo:guid,pictureCode:i},$.post(constant().url+"/pc/login/validatePicCode",t,function(e,t){"success"==t&&"0"==e.resultCode&&("1"==e.data.isPicCodeRight?s.addClass("validate-success").removeClass("validate-failed"):(s.addClass("validate-failed").removeClass("validate-success"),d.html("验证码错误!"),a.getImageCode()),a.initSendBtn())})},getPsdIsEqual:function(e){var t=_this.parent().parent(),a=t.find(".validation"),i=$("#txtPsd").val();e==i?t.addClass("validate-success").removeClass("validate-failed"):(t.addClass("validate-failed").removeClass("validate-success"),a.html("两次输入密码不一致!"))},initRegister:function(){a.getImageCode()},testRegister:function(e,t,i){var s,d=a.getSearchParts("dept");s=""!=d||"undefined"!=typeof d?{clientType:constant().clientType,mobileCode:e,mobileNo:t,password:i,readAndAgree:"1",dept:a.getSearchParts("dept")}:{clientType:constant().clientType,mobileCode:e,mobileNo:t,password:i,readAndAgree:"1"},$.post(constant().url+"/user/register/registerUser",s,function(e,i){if("success"==i){var s=$("#wranTip");if("0"==e.resultCode)session().set("lingtouniaoguanwangluodiyeshoujihao",t),location.href="/html/user/login/";else{$("#loginTip").show();var d;d=user().testResultCode(e.resultCode),s.html(d),a.initRegister()}}})},getPhoneAndCodeIsTrue:function(){var e=$("#wrapTel"),t=$("#wrapImg");return!(!e.hasClass("validate-success")||!t.hasClass("validate-success"))},initSendBtn:function(){a.getPhoneAndCodeIsTrue()?$("#sendPhoneCode").removeClass("disabled").removeAttr("disabled"):$("#sendPhoneCode").addClass("disabled").attr("disabled","disabled")},dealPhoneCode:function(){var e=$("#sendPhoneCode");e.html("发送中..."),e.attr("disabled","disabled"),a.getPhoneCode()},init:function(){guid=strUtil().getGuid(),a.getImageCode()}};a.init(),$("#submit").not(".disabled").on("click",function(){if(user().testSubmit(a.addEvent),0!=$("#form").find(".validate-failed").length)return!1;var e=strUtil().trim($("#txtPhoneCode").val()),i=strUtil().trim($("#txtTel").val());t=i,console.log(t);var s=$("#txtPsd").val();a.testRegister(e,i,s)}),$("#backIndex").on("click",function(){window.location.href="/html/?dept="+a.getSearchParts("dept")}),$("#isRead").on("change",function(){var e=$(this),t=$("#submit");e.attr("checked")?(e.attr("checked",!1),t.addClass("disabled"),t.attr("disabled","true")):(e.attr("checked","true"),t.removeClass("disabled"),t.removeAttr("disabled"))}),$("#sendPhoneCode").on("click",a.dealPhoneCode)});